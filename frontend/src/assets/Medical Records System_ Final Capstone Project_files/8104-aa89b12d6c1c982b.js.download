"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8104],{3738:(e,t,n)=>{n.d(t,{E:()=>u,b:()=>p});var o=n(84462),r=n.n(o),s=n(15342),a=n(14753),i=n(43634),l=n(29608),d=n(89115);let c=r()(()=>parseFloat(getComputedStyle(document.documentElement).fontSize)),u=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,{fontSize:t,defaultContentWidth:n}=(0,s.GV)(i.Uu);return p({zoomLevel:e,docSettingsFontSize:t,defaultContentWidth:n,viewportScaleFactor:(0,a.t)(),theme:(0,s.GV)(i.SJ)})},p=e=>{let{docSettingsFontSize:t,defaultContentWidth:n,zoomLevel:o=1,viewportScaleFactor:r,theme:s}=e,a=(0,l.Xb)(),{cardWidthEms:i,baseFontSize:u}=(0,d.S)({fontSize:t,contentWidth:n,theme:s,isMobileDevice:a});return r*u*c()*o*i}},5291:(e,t,n)=>{n.d(t,{b9:()=>h,go:()=>u,iJ:()=>c,iO:()=>p});var o=n(55729),r=n(22275),s=n(15342),a=n(86497),i=n(45400),l=n(34647),d=n(25991);let c=()=>{let e=(0,o.useRef)("unsynced"),t=(0,s.CU)(),n=(0,a.O)(),l=(0,o.useCallback)(async(o,r,s)=>{if((0,d.yy)(t.getState())||n){if("unsynced"!==e.current)return void console.warn("Cannot load doc from cache when it is already ".concat(e.current));await (0,i.f)().loadYDoc(o,r)&&(e.current="loaded",s())}},[n,t]),c=(0,o.useCallback)((o,s)=>{if(!((0,d.yy)(t.getState())||n))return;let a=(0,r.S)();if("unsynced"!==e.current)return void console.warn("Cannot sync doc to cache when it is already ".concat(e.current));a&&(0,i.f)().syncYDoc(o,s)},[n,t]);return(0,o.useMemo)(()=>({loadYDoc:l,syncYDoc:c}),[l,c])},u=()=>{let e=(0,s.jL)(),t=(0,s.CU)();return(0,o.useCallback)(function(n){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Date().toISOString();(0,d.yy)(t.getState())&&e((0,d.KT)({docIds:n,lastSynced:o}))},[e,t])},p=()=>{let e=(0,s.jL)(),t=(0,s.CU)();return(0,o.useCallback)(function(n){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Date().toISOString();if((0,d.yy)(t.getState()))return e((0,d.yK)({docId:n,lastSynced:o}))},[e,t])},h=()=>(0,o.useMemo)(()=>(0,l.S)(),[])},12733:(e,t,n)=>{let o,r;n.d(t,{W:()=>d});var s=n(55729),a=n(91938),i=n(68301),l=n(15342);Promise.all([n.e(6935),n.e(9978)]).then(n.bind(n,12504)).then(e=>{o=e.applyDevTools,r=e.removeDevTools});let d=e=>{let t=(0,l.GV)(i.Ew);(0,s.useEffect)(()=>{if(e){if(t){console.debug("[Prosemirror DevTools] Activating prosemirror-dev-tools");try{o(e.view)}catch(e){}}else try{r()}catch(e){}return a.$.DEBUG_ENABLED&&(window.openPMDT=()=>o(e.view)),()=>{r(),delete window.openPMDT}}},[e,t])}},27196:(e,t,n)=>{n.d(t,{Li:()=>o.Li,Rf:()=>r.R,kY:()=>r.k});var o=n(60300),r=n(69764)},30188:(e,t,n)=>{n.d(t,{b:()=>i,o:()=>l});var o=n(37243),r=n(63867),s=n(41797);let a=new r.hs("yDocSize"),i=e=>{let t=a.getState(e.state);return t?t.getYDocSize():null},l=o.YY.create({name:"yDocSize",addProseMirrorPlugins(){let{document:e}=this.options;return[new r.k_({key:a,state:{init:()=>new d(e),apply:(e,t)=>t}})]}});class d{getYDocSize(){return s.PR(this.ydoc).byteLength}constructor(e){this.ydoc=e}}},36679:(e,t,n)=>{n.d(t,{FM:()=>h,Lt:()=>p,Ur:()=>u,Yi:()=>m});var o=n(33750),r=n.n(o),s=n(55729),a=n(68301),i=n(15342),l=n(61385),d=n(43634),c=n(28615);let u="disable-card-size-animations",p=()=>{let e=(0,a.u)("autoZoomToFit"),t=(0,i.GV)(d.G7);return(0,s.useEffect)(()=>{t||f()},[t]),null!=t?t:e},h=()=>{let e=(0,i.GV)(d.$i),t=(0,s.useRef)(void 0),n=p(),o=!c.rS&&!c.GC&&n;(0,s.useEffect)(()=>{let n=!t.current;t.current=e,e&&o&&(document.body.classList.add(u),m(),requestAnimationFrame(()=>{document.body.classList.remove(u)}),n&&setTimeout(()=>{document.body.classList.add(u),m(),requestAnimationFrame(()=>{document.body.classList.remove(u)})},l.M2))},[e,o])},m=()=>{let e=document.documentElement.clientHeight,t=document.querySelector('[data-animate-value="presentCurrent"][data-card-scroll-element]');if(!t)return;let n=g(t,e,1);if(n<.9){let o=(1-n)/3;n=g(t,e,n+o)}(0,i.KA)().dispatch((0,d.ed)({zoomLevel:n}))},g=(e,t,n)=>{e.style.setProperty("--zoom-level",n.toString());let o=e.scrollHeight,s=r()(n*t/o,c.hQ?.5:l.bq,1);return e.style.setProperty("--zoom-level",s.toString()),s},f=()=>{document.querySelectorAll("[data-card-scroll-element]").forEach(e=>{e.style.removeProperty("--zoom-level")})}},51817:(e,t,n)=>{n.d(t,{f$:()=>r}),n(64704);let o=new URLSearchParams(window.location.search),r=(o.get("SCHEMA_VERSION")?Number(o.get("SCHEMA_VERSION")):null)||130},61121:(e,t,n)=>{n.d(t,{GO:()=>T,h3:()=>C,wn:()=>D,SS:()=>P,ZY:()=>R,er:()=>k,Gi:()=>_});var o=n(21938),r=n(37243),s=n(63867),a=n(97255),i=n(15342),l=n(43634),d=n(85235),c=n(33201),u=n(29608),p=n(67864);let h=e=>"buttonGroup"===e.type.name;var m=n(86958),g=n(6845),f=n(94922),y=n(98968),v=n(55424),b=n(60300),S=n(56124),w=n(85570),A=n(60122),M=n(56603);let E=()=>({absPositions:[],relPositions:[]});class x{getPositions(e){return e?this.presentModePositions:this.editModePositions}apply(e,t){let n=e.getMeta(w.g);if(n)switch(n.type){case"addAnimationPositions":this.addAnimationPositions(n.pos,t,n.isPresentMode);break;case"resetAnimationPositions":this.resetAnimationPositions(n.isPresentMode);break;case"enableAnimations":this.enabled=n.enabled;break;default:console.warn("AnimationsState: unknown action type",n)}return this}addAnimationPositions(e,t,n){let o=this.getPositions(n),r=Math.max(...o.absPositions);e.forEach(e=>{if(e<=r)return;o.absPositions.push(e);let n=(0,M.JO)(t,e);n&&o.relPositions.push(n)})}resetAnimationPositions(e){e?this.presentModePositions=E():this.editModePositions=E()}getAnimationPositionsAbs(e,t){let n=A.pJ.getState(e),o=this.getPositions(t);return n?o.relPositions.map(t=>(0,M.d_)(e,t)).filter(Boolean):o.absPositions}constructor(){this.enabled=!0,this.presentModePositions=E(),this.editModePositions=E()}}let k="animate-has-animated",C="animatable-on-load",T="animatable-on-load-as-block",P="animatable-on-load-content-parent",D="animatable-on-load-content-child",I=e=>{switch(e.type.name){case"card":return!0===(0,g.Wq)(e);case"cardAccentLayoutItem":return(0,f.wL)(e);case"calloutBox":case"gallery":case"smartLayout":case"divider":return!0;case"smartDiagram":return!(0,u.nr)();default:return(0,b.Rj)(e)}},z=(e,t)=>(0,v.q)(e)||(0,y.qK)(t),_=(e,t)=>{let n=e.view.state.doc.resolve(t);if(!n)return;let o=e.state.doc.nodeAt(t);if(o&&I(o)&&!z(o,n)){let e=o.isLeaf||o.isAtom?0:-1;return{pos:n.pos+e,start:n.pos,depth:n.depth,node:o}}return(0,r.eL)(n,I)},N=(e,t)=>{let n=t.getAnimationPositionsAbs(e,(0,l.wC)((0,i.KA)().getState())===d.w.SLIDE_VIEW).reduce((e,t)=>Math.max(e,t),0),o=e.doc.nodeAt(n),r=o&&n>0?o.nodeSize:0;return n+r},R=()=>new s.k_({key:w.g,state:{init:()=>new x,apply:(e,t,n,o)=>t.apply(e,o)},props:{decorations(e){let t=[],n=this.getState(e);if(!1===n.enabled)return a.zF.create(e.doc,t);let r=N(e,n);return e.doc.descendants((n,s,i,l)=>{let d=e.doc.resolve(s),u=I(n)||z(n,d);if(s<r&&u&&t.push(a.NZ.node(s,s+n.nodeSize,{class:k})),(0,v.M)(n)||(0,y.Pb)(n))t.push(a.NZ.node(s,s+n.nodeSize,{class:P}));else if(h(n)||(0,m.q)(n)||(0,S.hj)(n))t.push(a.NZ.node(s,s+n.nodeSize,{class:T}));else if(z(n,d))t.push(a.NZ.node(s,s+n.nodeSize,{class:D,style:"--animate-index: ".concat(l+1)}));else if(I(n)){let e=!!i&&(0,p.Ti)(n,i),r=n.isAtom;t.push(a.NZ.node(s,s+n.nodeSize,{class:(0,o.cx)(C,e&&"animatable-on-load-annotatable",r&&"animatable-on-load-atom")})),(0,f.wL)(n)&&t.push(a.NZ.node(s,s+n.nodeSize,{class:"animatable-on-load-accent"}))}return!((0,c.jg)(n)&&d.depth>1||(0,v.q)(n)||h(n)||(0,m.q)(n)||(0,S.hj)(n))}),a.zF.create(e.doc,t)}}})},64251:(e,t,n)=>{n.d(t,{wu:()=>I,el:()=>z});var o=n(6029),r=n(46898),s=n(54839),a=n(19564),i=n(37243),l=n(84462),d=n.n(l),c=n(50333),u=n.n(c),p=n(47687),h=n.n(p),m=n(55729),g=n(15342),f=n(61385),y=n(3738),v=n(47665),b=n(90010),S=n(14753),w=n(43634),A=n(15607),M=n(74677);let E=(e,t)=>e.docChanged?(0,M.A)(e).flatMap(n=>{let o={from:n.newStart,to:n.newEnd};return function(e,t,n){let o=[];if(t.from===t.to){let n=e.nodeAt(t.from);n&&o.push({node:n,pos:t.from})}return e.nodesBetween(t.from,t.to,(e,t)=>{n(e)&&o.push({node:e,pos:t})}),o}(e.doc,o,t)}):[];var x=n(67200),k=n(93321);let C="disable-card-size-animations",T=e=>{let{zoomToFit:t,zoomLevel:n,minZoomLevel:o}=e;return!t||n<=o},P=e=>{let{docSettings:t}=e;return t.scaleContentToFit&&"fluid"!==t.cardDimensions},D=()=>{var e;let t=null!=(e=(0,g.GV)(w.yh))&&e,n=(0,g.GV)(w.We),s=(0,g.GV)(w.Uu),i=(0,r.d)(),{min:l}=(0,k.R)(),[d,c]=(0,m.useState)(null),[u,p]=(0,m.useState)(null);return(0,m.useEffect)(()=>{n<=l&&P({docSettings:s})&&(u&&i.close(u),c(i({title:(0,o.jsx)(a.x6,{id:"IxUcyZ"}),description:(0,o.jsx)(a.x6,{id:"v9rGLj"}),status:"info",position:"top",duration:3e3})))},[n,s.scaleContentToFit,l,i,u]),(0,m.useEffect)(()=>{if(d&&n>l&&P({docSettings:s})){i.close(d);let e=i({title:(0,o.jsx)(a.x6,{id:"oWpmCA"}),description:(0,o.jsx)(a.x6,{id:"S0DQn7"}),status:"success",position:"top",duration:3e3});c(null),p(e)}},[d,s.scaleContentToFit,l,i,n]),T({zoomToFit:t,zoomLevel:n,minZoomLevel:l})},I=e=>{let{editor:t}=e,n=(0,g.CU)(),o=(0,S.t)(),r=D(),s=(0,m.useCallback)(e=>{var s;let{transaction:a}=e;if(!a.docChanged||a.getMeta("scaleContentToFit")||(0,x.he)(a)||r||a.getMeta("rearrangeCards"))return;let l=null==(s=(0,b.iS)(a.doc))?void 0:s.attrs.settings;if(!l||!P({docSettings:l}))return;if(a.steps.some(e=>"attr"in e&&"settings"===e.attr&&P({docSettings:l}))||(0,x.Xq)(a)){let e=(0,i.Nx)(a.doc,{from:0,to:a.doc.lastChild.nodeSize},v.jg);requestAnimationFrame(()=>{e.forEach(e=>{let{node:r}=e;_({id:r.attrs.id,editor:t,cardFontScale:r.attrs.fontScale,isTopLayout:"top"===r.attrs.layout,docSettingsFromTransaction:l,viewportScaleFactor:o,store:n})})});return}let d=E(a,v.jg);d.length&&d.forEach(e=>{let{node:r}=e;N({id:r.attrs.id,editor:t,cardFontScale:r.attrs.fontScale,isTopLayout:"top"===r.attrs.layout,docSettingsFromTransaction:l,viewportScaleFactor:o,store:n})})},[t,n,o,r]);return(0,m.useEffect)(()=>{if(t&&!t.isThumbnail)return t.on("update",s),()=>{t.off("update",s)}},[t,s]),null},z=e=>{var t;let{editor:n,store:o,viewportScaleFactor:r}=e;if(n.isThumbnail)return;let s=o.getState(),a=(0,w.Uu)(s);if(!a)return;let l=null!=(t=(0,w.yh)(s))&&t,d=(0,w.We)(s),c=(0,w.fX)(s),{min:u}=(0,k.C8)(c);!T({zoomToFit:l,zoomLevel:d,minZoomLevel:u})&&P({docSettings:a})&&requestAnimationFrame(()=>{let e=(0,i.Nx)(n.state.doc,{from:0,to:n.state.doc.content.size},v.jg).filter(e=>{let{node:t}=e;return!t.attrs.fontScale});e.length>0&&e.forEach(e=>{let{node:t}=e;_({id:t.attrs.id,editor:n,cardFontScale:t.attrs.fontScale,isTopLayout:"top"===t.attrs.layout,docSettingsFromTransaction:a,viewportScaleFactor:r,store:o})})})},_=async e=>{let{id:t,editor:n,cardFontScale:o,isTopLayout:r,docSettingsFromTransaction:s,viewportScaleFactor:a,store:i}=e;if(!n)return;let l=(0,v.W0)(n,t);if(!l)return;let d=(0,A.jB)(n,l.pos);if(!d)return;let c=R({cardElt:d,cardFontScale:o,isTopLayout:r,docSettingsFromTransaction:s,viewportScaleFactor:a,store:i});c!==o&&n.chain().updateAttributesAtPos(l.pos,{fontScale:c}).setMeta("scaleContentToFit",!0).setMeta("addToHistory",!1).run()},N=h()(_,250,{leading:!0}),R=e=>{let{cardElt:t,cardFontScale:n,isTopLayout:o,docSettingsFromTransaction:r,viewportScaleFactor:s,store:a}=e,i=(0,w.We)(a.getState()),l=(0,w.SJ)(a.getState()),d=1,c=null==t?void 0:t.querySelector("[data-card-id]"),p=null==t?void 0:t.querySelector("[data-card-body]"),h=O({docSettingsFromTransaction:r,zoomLevel:i,viewportScaleFactor:s,theme:l});if(!c||!p||!h)return n||d;let m=j(t,o),g=1.01*h;if(m>=h/1.01&&m<=g)return n;for(document.body.classList.add(C),d+=.05;d>f.o5&&(d=u()(d-.05,2),c.style.setProperty("--card-font-scale",d.toString()),!(j(t,o)<=g)););return document.body.classList.remove(C),requestAnimationFrame(()=>{c.style.removeProperty("--card-font-scale")}),d},O=d()(function(e){let{docSettingsFromTransaction:t,zoomLevel:n,viewportScaleFactor:o,theme:r}=e,a=null==t?void 0:t.cardDimensions,i=a?s.EXPORT_ASPECT_RATIOS[a]:16/9;if(i)return(0,y.b)({zoomLevel:n,docSettingsFontSize:null==t?void 0:t.fontSize,defaultContentWidth:null==t?void 0:t.defaultContentWidth,viewportScaleFactor:o,theme:r})/i});function j(e,t){let n=e.querySelector('[data-layout-item-id="body"]'),o=null==n?void 0:n.querySelector("[data-node-view-content]"),r=e.querySelector('[data-layout-item-id="accent"]');if(t&&r){let e=r.clientHeight,t=null==o?void 0:o.clientHeight;return t?t+e:0}return(null==o?void 0:o.clientHeight)||0}},68104:(e,t,n)=>{n.d(t,{H2:()=>oS,bw:()=>V.b,u5:()=>ok.u,k5:()=>oE,HC:()=>oM,f$:()=>ox});var o=n(97255);o.Lz.prototype.updateState=function(e){this.docView&&this.updateStateInner(e,this.state.plugins!=e.plugins)};var r=n(6029),s=n(26420),a=n(53996),i=n(26385),l=n(3276),d=n(48810),c=n(40510),u=n(90865),p=n(39891),h=n(55729),m=n(57067),g=n(41797),f=n(91938),y=n(35292),v=n(82328),b=n(89414),S=n(12364),w=n.n(S),A=n(63867),M=n(68301),E=n(15342),x=n(39977),k=n(56603),C=n(47956),T=n(61385),P=n(15607);let D=(e,t)=>{let n=e.state.doc.content.content[0].content.content[0].attrs.id,o=e.state.doc.resolve(t),r=e.state.doc.nodeAt(t);if((null==r?void 0:r.type.name)==="card"&&1===o.depth)return r.attrs.id;let s=(0,P.Ft)(o,(e,t)=>"card"===e.type.name&&t<=T.$x);return s?s.node.attrs.id:n},I=e=>{let t=(0,E.CU)(),n=(0,E.jL)();(0,h.useEffect)(()=>{if(!e)return;let t=()=>{let t=z(e);n((0,C.II)(t))},o=w()(t,200,{leading:!0,maxWait:500});return e.on("update",o),e.on("selectionUpdate",o),t(),()=>{e.off("update",o),e.off("selectionUpdate",o)}},[e,n,t])},z=e=>{if(!e)return null;let t=e.state.selection;if(!t)return null;let n=(0,x.A)({editor:e,selection:t}),o=D(e,t.from);if((null==n?void 0:n.mediaType)==="image"&&M.of.get("buddyEditGa"))return{type:"image",attrs:n.attrs,id:n.id,from:(0,k.JO)(e.state,t.from),to:(0,k.JO)(e.state,t.to),cardId:o};if(t instanceof A.U3)return{type:"text",from:(0,k.JO)(e.state,t.from),to:(0,k.JO)(e.state,t.to),text:e.state.doc.textBetween(t.from,t.to),cardId:o,length:t.to-t.from};let r=e.state.doc.nodeAt(t.from);return t instanceof A.nh&&(null==r?void 0:r.type.name)==="card"?{type:"card",cardId:r.attrs.id}:null};var _=n(35946),N=n(94929);let R=e=>{let t=(0,E.jL)(),{setMessages:n}=(0,_.Y_)({id:(0,N.D)(e)});return(0,h.useCallback)(()=>{t((0,C.ZQ)({isUnloading:!0})),n([])},[t,n])},O=(e,t)=>{let n=R(t);(0,h.useEffect)(()=>{e&&t&&e.on("destroy",()=>{console.log("[buddy persistence] unload buddy chat"),n()})},[t,e,n])};var j=n(65280),L=n(32617),B=n(5291),F=n(59190),H=n(91792),G=n(30188),Y=n(82927),U=n(85057),q=n(64251),V=n(10817),J=n(17928),W=n(37243),K=n(53907),Z=n(91242),Q=n(47665);let $=()=>{let e=document.createElement("span");e.classList.add("collaboration-cursor__caret","streaming-cursor"),e.setAttribute("style","border-color: var(--chakra-colors-trueblue-100)");let t=document.createElement("div");return t.classList.add("collaboration-cursor__label","streaming-cursor__label"),t.setAttribute("style","background-color: var(--chakra-colors-trueblue-100); color: var(--chakra-colors-trueblue-400)"),e.insertBefore(t,null),e},X=W.YY.create({name:"aiGeneration",addOptions:()=>({provider:null}),addStorage:()=>({generationEnabled:!1}),onCreate(){let{provider:e}=this.options;e&&e.awareness&&e.awareness.on("change",()=>{if(!e.awareness)return;let t=!1;for(let[n,o]of e.awareness.getStates())o.isStreaming&&n!==e.awareness.clientID&&(t=!0);let n=(0,E.KA)();(0,K.kg)(n.getState())!==t&&n.dispatch((0,K.gR)(t))})},addCommands(){return{setAIGenerationRunning:e=>()=>{var t,n;return this.storage.generationEnabled=e,null==(n=this.options.provider)||null==(t=n.awareness)||t.setLocalStateField("isStreaming",e),!0}}},addProseMirrorPlugins(){let{storage:e}=this;return[new A.k_({key:new A.hs("aiGeneration"),props:{decorations(t){if(!e.generationEnabled)return o.zF.empty;let n=[],r=t.doc.content.size-2,s=(0,W.eL)(t.doc.resolve(r),Q.jg),a=s?(0,Z.s)(t.doc.resolve(s.pos),-1):null;return a&&s&&(n.push(o.NZ.widget(a.from,$,{key:"sal",side:10})),n.push(o.NZ.node(s.pos,s.pos+s.node.nodeSize,{class:"ai-generate-streaming-card"}))),o.zF.create(t.doc,n)}}})]}});var ee=n(15440);let et=()=>new A.k_({key:ee.G,state:{init:()=>new ee.Z,apply:(e,t,n,o)=>t.apply(e,o)}}),en=W.YY.create({name:"aiModifications",onCreate(){this.options.document.on("afterAllTransactions",e=>{let t=ee.G.getState(this.editor.view.state);t&&t.flushMoveInstructionQueue(this.editor.view.state)})},addProseMirrorPlugins:()=>[et()],addCommands:()=>({setInteractionRange:(e,t)=>n=>{let{tr:o}=n;return o.setMeta("aiModificationAction",{type:"setInteractionRange",rangeId:e,range:t}),!0}})});var eo=n(34832),er=n(93298),es=n(17859),ea=n(6018),ei=n(24939),el=n(58809),ed=n(23513),ec=n(42721),eu=n(53615),ep=n(67200),eh=n(23050),em=n(91656);let eg=e=>{let{selection:t}=e,n=t.$head||t.$anchor,o=(0,W.eL)(n,e=>"paragraph"===e.type.name||(0,em.x)(e));return o&&o.node.content.size?o:null},ef=e=>{let{view:t,state:n,isFlagEnabled:o,editor:r}=e;if(!o)return null;let{selection:s}=n,{empty:a}=s,i=eh.nD.getState(n),l=eg(n),d=null==i?void 0:i.loading;return t.hasFocus()&&a&&l&&r.isEditable&&!d?l:null},ey=e=>new A.k_({key:eh.nD,state:{init:()=>({loading:!1,insertedRange:null,interactionId:null}),apply(e,t){let n=e.getMeta("autocompleteEvent");return(null==n?void 0:n.type)==="reset"?{loading:!1,insertedRange:null,interactionId:null}:(null==n?void 0:n.type)==="load"?{loading:!0,insertedRange:null,interactionId:null}:(null==n?void 0:n.type)==="insert"?{loading:!1,insertedRange:n.range,interactionId:n.interactionId}:(0,ep.Xq)(e)?{loading:!1,insertedRange:null,interactionId:null}:t}},props:{handleKeyDown(t,n){var o,r,s;if("Tab"!==n.key){let n=eh.nD.getState(t.state);return(null==n?void 0:n.insertedRange)&&e.commands.setMeta("autocompleteEvent",{type:"reset"}),!1}let{state:a}=t,i=ef({view:t,state:a,isFlagEnabled:M.of.get("arrowAutocomplete"),editor:e}),{selection:l}=a;return l.from===l.to&&(null==(o=l.$from.nodeBefore)?void 0:o.type.name)==="text"&&!!i&&(n.preventDefault(),(0,es.TS)(),e.commands.autoComplete(),null==(r=(s=e.commands).forceHideAutocompleteButton)||r.call(s,!0),!0)},decorations(e){let t=[],n=eh.nD.getState(e),{selection:r,doc:s}=e,{loading:a,insertedRange:i}=n||{};if(a){let e=o.NZ.widget(r.from,()=>{let e=document.createElement("span");return e.className="autocomplete-loading",e});t.push(e)}if(i){let e;try{e=(0,W.Nx)(s,i,e=>e.isTextblock)}catch(t){e=[]}e.forEach(e=>{let{node:n,pos:r}=e,s=Math.max(r+1,i.from),a=Math.min(r+n.nodeSize-1,i.to),l=o.NZ.inline(s,a,{class:"autocomplete-inserted autocomplete-highlight"});t.push(l)})}return t.length?o.zF.create(s,t):o.zF.empty}}}),ev=/(\+\+\+)/,eb=W.YY.create({name:"autocomplete",addProseMirrorPlugins(){return[ey(this.editor)]},addCommands:()=>({autoOutline:()=>e=>{let{editor:t,state:n,tr:o}=e,{selection:r,doc:s}=n,{$from:a,from:i}=r,l=(0,k.JO)(n,a.after()),d=(0,W.KP)(Q.jg)(r);return!!d&&!!l&&((0,eu.s6)(s,d.pos,i),o.setMeta("autocompleteEvent",{type:"load"}),!0)},autoComplete:()=>e=>{var t;let{editor:n,state:o,tr:r}=e,{selection:s,doc:a}=o,{from:i}=s,l=(0,k.JO)(o,i);if(!(M.of.get("aiAutocomplete")&&s.empty&&s instanceof A.U3&&l))return!1;let d=(0,E.KA)().getState(),c=null==(t=(0,el.Jo)(d))?void 0:t.organization;if(!(0,ei.ny)("autocomplete",c))return!1;let u=(0,eu.s6)(a,Math.max(s.from-1e3,0),s.from),p=(0,er.p9)(u).slice(-200),h=(0,er.$0)(p),m=a.textBetween(s.from-10,s.to);r.setMeta("autocompleteEvent",{type:"load"});let g=(0,es.$F)(),f=performance.now(),y={interactionId:g,interface:"autocomplete",inputContent:u};return(0,es.rl)(y),(0,eo.K8)({promptKey:"Autocomplete",variables:{text:h},interactionId:g,workspaceId:(0,ec.gx)()}).then(e=>{var t,r,s;let a=(0,k.d_)(o,l);if(!e||!a)throw Error("No completion or insertPos");e=e.trim();let i={from:a,to:a},d=n.chain().insertMarkdownAt(i,e).command(e=>{let{tr:t}=e,n=(0,ed.i)(t);return!n||(i.to=n.to,t.setSelection(n).scrollIntoView(),!0)});(null==(t=o.doc.resolve(a).nodeBefore)?void 0:t.isText)&&!(m.endsWith(" ")||m.endsWith("\n"))&&d.insertContentAt(a," ",{updateSelection:!1}).command(e=>{let{tr:t}=e;return i.to+=1,t.setSelection(new A.U3(t.doc.resolve(i.to))),!0}),d.setMeta("autocompleteEvent",{range:i,interactionId:g,type:"insert"}).run(),(0,es.UL)({...y,outputContent:e,latency:performance.now()-f,timeToComplete:performance.now()-f}),null==(r=(s=n.commands).forceHideAutocompleteButton)||r.call(s,!1),n.commands.focus(),(0,ea.w)("autocomplete",c,g)}).catch(e=>{console.warn("Error fetching autocomplete",e),n.commands.setMeta("autocompleteEvent",{type:"reset"})}),!0}}),addInputRules:()=>[new W.fV({find:ev,handler:e=>{let{range:t,chain:n}=e;(0,es.kD)(),n().setTextSelection(t).deleteSelection().autoComplete().run()}})]});var eS=n(37393),ew=n(41427),eA=n(77711);let eM=e=>e.pos+e.node.nodeSize-1;class eE{initialize(e){let{buttonElement:t,tippyTarget:n,onHide:o}=e;if(this.isFlagEnabled){if(!t||!n)return void console.warn("[AutocompleteButtonView] initialize. No element provided");this.element=t,this.target=n,this.onHide=o,this.element.addEventListener("mousedown",this.mousedownHandler,{capture:!0}),this.editor.on("focus",this.focusHandler),this.editor.on("blur",this.blurHandler),this.createTooltip(),this.element.style.visibility="visible"}}createTooltip(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;if(!this.isFlagEnabled)return;let n=t||this.view.dom.parentElement;n&&this.element&&(this.tippy=(0,eS.Ay)(n,{duration:0,getReferenceClientRect:null,content:this.element,interactive:!0,trigger:"manual",placement:"right",hideOnClick:"toggle",offset:[0,8],...e}),this.tippy.popper.firstChild&&this.tippy.popper.firstChild.addEventListener("blur",this.tippyBlurHandler))}update(e,t){if(!this.isFlagEnabled)return;let{state:n,composing:o}=e,{doc:r,selection:s}=n,a=t&&eA.f.getState(t),i=eA.f.getState(e.state),l=t&&t.doc.eq(r)&&t.selection.eq(s)&&this.isEditable===this.editor.isEditable&&(null==a?void 0:a.forceHide)===i.forceHide;if(!this.element||!this.target){if(!i.buttonElement||!i.tippyTarget)return;this.initialize(i)}let d=!(null==t?void 0:t.selection.eq(s)),c=!(null==t?void 0:t.doc.eq(r));if(this.isEditable=this.editor.isEditable,!this.editor.isEditable||!0===i.forceHide)return void this.hide();if(!o&&!l)if(d&&!c){if(!this.shouldShow({view:e,state:n}))return void this.hide();this.show()}else c&&(this.hide(),this.typingTimeout&&clearTimeout(this.typingTimeout),this.typingTimeout=setTimeout(()=>{this.editor&&this.view.hasFocus()&&this.shouldShow({view:e,state:this.editor.state})&&this.show()},750))}show(){var e,t;if(!this.isFlagEnabled||!this.validParentNode||(this.nodeEndPos=eM(this.validParentNode),!this.nodeEndPos))return;let n=(0,ew.KQ)(this.validParentNode.node);null==(e=this.tippy)||e.setProps({getReferenceClientRect:()=>(0,W.MG)(this.editor.view,this.nodeEndPos||0,this.nodeEndPos||0),placement:"rtl"===n?"left":"right"}),this.element&&(this.element.style.transform="rtl"===n?"scaleX(-1)":"none"),null==(t=this.tippy)||t.show()}hide(){var e;this.isFlagEnabled&&(this.onHide&&"function"==typeof this.onHide&&this.onHide(),null==(e=this.tippy)||e.hide())}destroy(){var e,t,n;this.isFlagEnabled&&(this.typingTimeout&&clearTimeout(this.typingTimeout),(null==(e=this.tippy)?void 0:e.popper.firstChild)&&this.tippy.popper.firstChild.removeEventListener("blur",this.tippyBlurHandler),null==(t=this.tippy)||t.destroy(),null==(n=this.element)||n.removeEventListener("mousedown",this.mousedownHandler,{capture:!0}),this.editor.off("focus",this.focusHandler),this.editor.off("blur",this.blurHandler))}constructor({editor:e,view:t}){this.element=null,this.target=null,this.preventHide=!1,this.typingTimeout=null,this.validParentNode=null,this.nodeEndPos=null,this.mousedownHandler=()=>{this.nodeEndPos&&this.isFlagEnabled&&(this.preventHide=!0,this.editor.commands.setTextSelection(this.nodeEndPos),setTimeout(()=>{(0,es.py)(),this.editor.commands.autoComplete(),this.hide()}))},this.focusHandler=()=>{setTimeout(()=>this.update(this.view))},this.blurHandler=e=>{var t,n;let{event:o}=e;if(this.preventHide){this.preventHide=!1;return}(null==o?void 0:o.relatedTarget)&&(null==(n=this.element)||null==(t=n.parentNode)?void 0:t.contains(o.relatedTarget))||(null==o?void 0:o.relatedTarget)!==this.editor.view.dom&&this.hide()},this.tippyBlurHandler=e=>{this.blurHandler({event:e})},this.shouldShow=e=>{let{view:t,state:n}=e;return!!this.isFlagEnabled&&(this.validParentNode=ef({view:t,state:n,isFlagEnabled:this.isFlagEnabled,editor:this.editor}),!!this.validParentNode)},this.isFlagEnabled=M.of.get("arrowAutocomplete"),this.editor=e,this.view=t,this.isEditable=e.isEditable}}let ex=W.YY.create({name:"autocompleteButton",addCommands:()=>({forceHideAutocompleteButton:e=>t=>{let{tr:n}=t;return n.setMeta(eA.f,{forceHide:e}),!0}}),addProseMirrorPlugins(){let{editor:e}=this;return[new A.k_({key:eA.f,state:{init:()=>({buttonElement:null,tippyTarget:null,forceHide:!1,onHide:()=>{}}),apply(e,t){let n=e.getMeta(eA.f);return n?{...t,...n}:t}},view:t=>new eE({view:t,editor:e})})]}});var ek=n(21938),eC=n(22249);let eT=e=>new A.k_({props:{attributes:()=>{let e=(0,E.KA)().getState();return{class:(0,eC.iZ)("buddy-chat")(e)?"buddy-active":""}},decorations:t=>{let{doc:n,selection:r}=t;if(!e.isEditable)return;let{from:s,to:a}=r,i=[],l=(0,E.KA)().getState();if((0,P.We)(e))return;let d=(0,C.MR)(l);if((0,eC.iZ)("buddy-chat")(l)&&d)return r instanceof A.U3?i.push(o.NZ.inline(s,a,{class:(0,ek.cx)("is-selecting-text")})):r instanceof A.nh&&i.push(o.NZ.node(s,a,{class:(0,ek.cx)("is-selecting-node")})),o.zF.create(n,i)}}}),eP=W.YY.create({name:"buddyExtension",addProseMirrorPlugins(){return[eT(this.editor)]}});var eD=n(55084);let eI=(e,t)=>new A.k_({props:{attributes:()=>{let e=(0,E.KA)().getState(),n=(0,eC.iZ)("buddy-chat")(e);return t.salPanelOpen?{class:"sal-active"}:n?{class:"buddy-active"}:{class:""}},decorations:n=>{let{doc:r,selection:s}=n;if(!e.isEditable)return;let{from:a,to:i}=s,l=[],d=(0,E.KA)().getState(),c=(0,eD.yZ)(d);if((0,eC.iZ)("image-chat")(d)&&c&&s instanceof A.nh)return l.push(o.NZ.node(s.from,s.to,{class:"is-selecting-node"})),o.zF.create(r,l);let u=(0,eC.iZ)("buddy-chat")(d);return t.salPanelOpen||u?((0,P.IV)(s.$from,Q.jg).forEach((e,t)=>{l.push(o.NZ.node(e.pos,e.pos+e.node.nodeSize,{class:(0,ek.cx)(0==t?"sal-active-card buddy-active-card":"sal-active-card-parent")}))}),(0,P.We)(e)||(s instanceof A.U3?l.push(o.NZ.inline(a,i,{class:(0,ek.cx)("sal-selection-text")})):s instanceof A.nh&&l.push(o.NZ.node(a,i,{class:(0,ek.cx)("sal-selection-node")}))),o.zF.create(r,l)):void 0}}}),ez=W.YY.create({name:"salExtension",addStorage:()=>({salPanelOpen:!1}),addProseMirrorPlugins(){return[eI(this.editor,this.storage)]},addCommands(){return{setSalOpen:e=>t=>{let{state:n,dispatch:o}=t;return this.storage.salPanelOpen=e,!0}}}});var e_=n(78116),eN=n(60122),eR=n(62040),eO=n(73364);class ej extends eO.c{[Symbol.iterator](){return this.yarray[Symbol.iterator]()}values(){let e=this.yarray.length,t=-1;return{[Symbol.iterator]:()=>({next(){return++t===e?{value:void 0,done:!0}:{value:this.yarray.get(t),done:!1}}})}}forEach(e){return this.yarray.forEach(e)}set(e,t){return this.doc.transact(n=>{this.map.has(e)&&this.delete(e),this.yarray.push([{key:e,val:t}])}),t}delete(e){let t=0;for(let n of this.yarray){if(n.key===e){this.yarray.delete(t);break}t++}}get(e){let t=this.map.get(e);return t&&t.val}has(e){return this.map.has(e)}constructor(e){super(),this.yarray=e,this.doc=e.doc,this.map=new Map;let t=e.toArray();this.doc.transact(n=>{for(let n=t.length-1;n>=0;n--){let o=t[n];this.map.has(o.key)?e.delete(n):this.map.set(o.key,o)}}),e.observe(t=>{let n=new Map,o=Array.from(t.changes.added);t.changes.deleted.forEach(e=>{e.content.getContent().forEach(e=>{this.map.get(e.key)===e&&(this.map.delete(e.key),n.set(e.key,{action:"delete",oldValue:e.val}))})});let r=new Map;o.map(e=>e.content.getContent()).flat().forEach(e=>{r.set(e.key,e)});let s=new Set,a=e.toArray();this.doc.transact(t=>{for(let t=a.length-1;t>=0&&(r.size>0||s.size>0);t--){let o=a[t];if(s.has(o.key))s.delete(o.key),e.delete(t,1);else if(r.get(o.key)===o){let e=this.map.get(o.key);if(e)s.add(o.key),n.set(o.key,{action:"update",oldValue:e.val,newValue:o.val});else{let e=n.get(o.key);e&&"delete"===e.action?n.set(o.key,{action:"update",newValue:o.val,oldValue:e.oldValue}):n.set(o.key,{action:"add",newValue:o.val})}r.delete(o.key),this.map.set(o.key,o)}else r.has(o.key)&&(s.add(o.key),r.delete(o.key))}}),n.size>0&&this.emit("change",[n])})}}class eL{run(e){}}class eB extends eL{createKeyValue(e,t){return new ej(e.getArray(t))}getRestoreMap(e){return e.getMap("annotationsAbsolute")}run(e){let t=this.createKeyValue(e,"annotationsAbsoluteKV");for(let[n,o]of this.getRestoreMap(e).entries())t.set(n,o)}constructor(...e){super(...e),this.name="AnnotationsYKeyValue"}}class eF{runMigrations(){let e=this.getMigrationsMap();for(let t of this.migrations)if(!this.hasRunMigration(t.name))try{t.run(this.document),e.set(t.name,!0)}catch(e){}}getMigrationsMap(){return this.document.getMap(eF.ANNOTATION_MIGRATIONS_KEY)}hasRunMigration(e){return this.getMigrationsMap().get(e)||!1}constructor(e){this.migrations=[new eB],this.document=e,this.document.transact(()=>{this.runMigrations()}),this.annotations=this.document.getMap("annotations"),this.annotationsAbsolute=new ej(this.document.getArray("annotationsAbsoluteKV"))}}eF.ANNOTATION_MIGRATIONS_KEY="annotationMigrations";class eH{get id(){return this.decoration.type.spec.id}get from(){return this.decoration.from}get data(){return this.decoration.type.spec.data}get HTMLAttributes(){return this.decoration.type.attrs}toString(){return JSON.stringify({id:this.id,data:this.data,from:this.from,HTMLAttributes:this.HTMLAttributes})}constructor(e){this.decoration=e}}var eG=n(53885),eY=n(46814),eU=n(9922),eq=n.n(eU),eV=n(35342),eJ=n.n(eV),eW=n(831),eK=n.n(eW),eZ=n(67864);function eQ(e){let t=[];for(let n=e.length-1;n>=0;n--){let o=e[n];t.push({...o,prev:o.next,next:o.prev})}return t}class e${flushUndoQueue(){let{undoQueue:e}=this;return this.undoQueue=[],e}set(e,t){let n=this.map.get(e);return this.undoQueue.unshift({type:"set",key:e,next:n,prev:t}),this.map.set(e,t)}delete(e){let t=this.map.get(e);return void 0===t||this.undoQueue.unshift({type:"set",key:e,next:t,prev:void 0}),this.map.delete(e)}constructor(e){this.map=e,this.undoQueue=[]}}class eX{persistRestoreMap(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n={deletion:0,relToAbs:0,setting:0,total:0},o=performance.now();(t||this.hasChanges)&&(this.transactYDoc(()=>{let t=performance.now();for(let{key:e}of this.restoreMap)this.restoreMap.delete(e);n.deletion=performance.now()-t,this.map.forEach(t=>{let{id:o,pos:r,data:s}=t;try{let t=performance.now(),a=this.relToAbs(e,r);n.relToAbs+=performance.now()-t;let i=performance.now();this.restoreMap.set(o,{id:o,data:s,absPos:a}),n.setting+=performance.now()-i}catch(e){console.error("[Annotations] persistRestoreMap error: ",e.message)}})}),n.total=performance.now()-o,this.log("[Annotations] persistRestoreMap in ".concat(n.total,"ms"),{values:this.restoreMap.yarray.toArray(),performance:n}),this.hasChanges=!1)}flushMoveInstructionQueue(){let{moveInstructionMap:e}=this;return this.moveInstructionMap={},Object.values(e)}clearCutData(){this.cutData=null,this.filmstripCutData=null}getAnnotationsBetween(e,t,n){let o=[];for(let r of this.map.values())try{let s=this.relToAbs(e,r.pos);if(null===s)continue;t<=s&&s<n&&o.push({id:r.id,data:r.data,pos:s,relativePos:r.pos})}catch(e){console.warn("[Annotations] getAnnotationsBetween error: ",e.message)}return o}apply(e,t){if((0,ep.LP)(e)){try{this.createDecorations(t)}catch(e){console.warn("[Annotations] handle remote change, not create decorations: ".concat(e.message))}return this}let n=e.getMeta(eG.q);if(n){switch(n.type){case"addAnnotation":this.addAnnotation(n,t);break;case"restoreAnnotations":this.restoreAnnotations(n);break;case"clearAnnotations":this.clearAnnotations();break;case"deleteAnnotation":this.deleteAnnotation(n.id);break;case"refreshAnnotationDecorations":try{this.createDecorations(t)}catch(e){console.warn("could not create decorations: ".concat(e.message))}break;case"moveAnnotations":this.moveAnnotations(t,n.toMove)}return this.hasChanges=!0,this}switch(e.getMeta("uiEvent")){case"cut":this.handleCutTransaction(t,e);break;case"paste":this.handlePasteTransaction(t,e)}let o=e.getMeta("annotationEvent");switch(null==o?void 0:o.type){case"split-card":this.handleSplitCard(t,e,o);break;case"split-block":this.handleSplitBlock(t,e,o);break;case"join-forward":this.handleJoinForward(t,e,o);break;case"join-backward":this.handleJoinBackward(t,e,o);break;case"update-node-attrs":this.handleUpdateNodeAttrs(t,e,o);break;case"rearrange-cards":this.handleRearrangeCards(t,e,o);break;case"move":this.handleMove(t,e,o);break;case"merge-cards":this.handleMergeCards(t,e,o);break;case"drop":this.handleDropAnnotations(t,e,o);break;case"unwrap-node":this.handleUnwrapNode(t,e,o);break;case"wrap-nodes":this.handleWrapNodes(t,e,o);break;case"filmstrip-cut":this.handleFilmstripCut(t,e,o);break;case"filmstrip-paste":this.handleFilmstripPaste(t,e,o);break;default:e.getMeta("appendedTransaction")||(this.handleReplaceTransaction(t,e),this.handleReplaceAroundTransaction(t,e))}return e.docChanged&&(this.hasChanges=!0),this.handleLocalChange(e)}restore(e,t){t.forEach(t=>{let{next:n,key:o}=t;void 0===n?this.map.delete(o):this.map.set(o,{...n,pos:this.refreshRelativePos(e,n.pos)})}),this.persistRestoreMap(e,!0)}handleUnwrapNode(e,t,n){let{pos:o}=n,r=t.before.resolve(o),s=r.start(r.depth+1),a=t.before.resolve(s).end(),i=this.getAnnotationsBetween(e,s,a).map(t=>{let{id:n,relativePos:r}=t,a=this.relToAbs(e,r);return null===a?null:{id:n,newPos:o+(a-s)}}).filter(e=>!!e);this.log("%c[Annotations] unwrap node","color: green",{tr:t,pos:o,start:s,end:a,toMove:i}),i.length>0&&this.enqueueMoveInstructions(i)}handleWrapNodes(e,t,n){let{start:o,end:r,level:s}=n,a=this.getAnnotationsBetween(e,o,r).map(e=>{let{id:t,pos:n}=e;return{id:t,newPos:n+s}}).filter(e=>!!e);this.log("%c[Annotations] wrap nodes","color: green",{tr:t,start:o,end:r,toMove:a}),a.length>0&&this.enqueueMoveInstructions(a)}handleMergeCards(e,t,n){let{insertPos:o,contentPos:r}=n,s=t.before.nodeAt(r);if(!s)return void console.error("[AnnotationState] trying to merge cards, but cannot resolve content wrapper");let a=this.getAnnotationsBetween(e,r,r+s.nodeSize).map(e=>{let{id:t,pos:n}=e;return{id:t,newPos:o+(n-r-1)}});this.log("%c[Annotations] merge cards","color: green",{transaction:t,insertPos:o,contentPos:r,toMove:a}),a.length>0&&this.enqueueMoveInstructions(a)}handleRearrangeCards(e,t,n){let{rearrangedCardPositions:o,insertPos:r}=n,s=o.flatMap(n=>{let{newPos:o,oldPos:r}=n,s=t.before.resolve(r);return this.getAnnotationsBetween(e,r,r+s.nodeAfter.nodeSize).map(e=>{let{id:t,pos:n}=e;return{id:t,newPos:o+(n-r)}})}),a=[],i=(0,Q.aJ)(t.before);if(i){let n=o[0].oldPos,s=Math.min(n,r),l=Math.max(n,r);a=i.flatMap(n=>{let{node:r,pos:a}=n;if(!(a>=s&&a<=l&&!o.find(e=>e.id===r.attrs.id)))return[];{let n=t.before.resolve(a),o=a+n.nodeAfter.nodeSize;return this.getAnnotationsBetween(e,a,o).map(e=>{let{id:n,pos:o}=e;return{id:n,newPos:t.mapping.map(o)}})}})}this.log("%c[Annotations] rearrange cards","color: green",{transaction:t,rearrangedCardPositions:o,annotationsInRearrangedCards:s,jumpedAnnotations:a});let l=[...s,...a];l.length>0&&this.enqueueMoveInstructions(l)}handleMove(e,t,n){let{insertPos:o,insertPosRaw:r,pos:s,end:a}=n,i=this.getAnnotationsBetween(e,s,a).map(e=>{let{id:t,pos:n}=e;return{id:t,newPos:o+(n-s)}}),l=this.getAnnotationsBetween(e,Math.min(r,a),Math.max(r,s)).map(e=>{let{id:n,pos:o}=e;return{id:n,newPos:t.mapping.map(o)}});this.log("%c[Annotations] move","color: green",{transaction:t,insertPos:o,insertPosRaw:r,pos:s,end:a,annotationsInCard:i,jumpedAnnotations:l});let d=[...i,...l];d.length>0&&this.enqueueMoveInstructions(d)}handleUpdateNodeAttrs(e,t,n){let{pos:o}=n,r=t.doc.nodeAt(o);if(!r)return;let s=this.getAnnotationsBetween(e,o,o+r.nodeSize).map(e=>{let{id:t,pos:n}=e;return{id:t,newPos:n}});this.log("%c[Annotations] update node attrs","color: green",{transaction:t,pos:o,toMove:s}),s.length>0&&this.enqueueMoveInstructions(s)}handleJoinBackward(e,t,n){let{atBeginning:o,joinPos:r}=n;if(!o)return;let s=t.before.resolve(r),a=t.before.resolve(s.before()),i=a.nodeBefore,l=a.nodeAfter;if(!i||!l)return;let d=a.pos+l.nodeSize,c=a.pos-i.nodeSize,u=e.selection.from;this.log("%c[Annotations] join backward","color: green",{transaction:t,prevBlock:i,nextBlock:l,nextBlockPos:a.pos,nextBlockEnd:d,prevBlockPos:c,joinPoint:u});let p=this.getAnnotationsBetween(e,a.pos,d);if(0===p.length)return void this.enqueueRefreshDecorations();0===l.content.size?(p.forEach(e=>{let{id:t}=e;return this.undoableMap.delete(t)}),requestAnimationFrame(()=>{this.writeUndoStack(e)})):this.enqueueMoveInstructions(p.map(e=>{let{id:t,pos:n}=e,o=Math.max(n-a.pos-1,0);return{id:t,newPos:(0===i.content.size?c:u)+o}}))}handleJoinForward(e,t,n){let{atEnd:o,joinPos:r}=n;if(!o)return;let s=t.before.resolve(r),{pos:a,node:i}=(0,P.TK)(s,e=>e.isBlock)[0],l=t.before.resolve(s.after()),d=l.nodeAfter;if(!d)return;let c=l.pos+d.nodeSize;this.log("%c[Annotations] join forward","color: green",{sel:e.selection,prevBlock:i,transaction:t,deleteAnnotations:!!d.isAtom,joinPos:s.pos,prevBlockPos:a,nextBlockPos:l.pos,nextBlock:d});let u=this.getAnnotationsBetween(e,a,a+i.nodeSize),p=this.getAnnotationsBetween(e,l.pos,c);if(0===p.length&&0===u.length)return void this.enqueueRefreshDecorations();let h=t=>{t.forEach(e=>{let{id:t}=e;return this.undoableMap.delete(t)}),requestAnimationFrame(()=>{this.writeUndoStack(e)})};d.isAtom&&i.content.size>0?h(p):0===i.content.size?h(u):this.enqueueMoveInstructions(p.map(e=>{let{id:t,pos:n}=e,o=Math.max(n-l.pos-1,0);return{id:t,newPos:(0===i.content.size?a:r)+o}}))}handleSplitBlock(e,t,n){let{splitPos:o,atBeginning:r}=n;if(r)return void this.enqueueRefreshDecorations();let s=t.before.resolve(o),{pos:a,node:i}=(0,P.TK)(s,e=>e.isBlock)[0],{$from:l}=e.selection,d=(0,P.TK)(l,e=>e.isBlock)[0],c=this.getAnnotationsBetween(e,o,a+i.nodeSize).map(e=>{let{id:t,pos:n}=e,r=n-o;return{id:t,newPos:d.pos+(0===r?r:r+1)}});c.length>0?this.enqueueMoveInstructions(c):this.enqueueRefreshDecorations(),this.log("%c[Annotations] split block","color: green",{sel:e.selection,transaction:t,splitPos:o,toMove:c,$before:s})}handleSplitCard(e,t,n){let{splitPos:o}=n,r=t.before.resolve(o),s=(0,P.TK)(r,Q.jg)[0];if(!s)return;let a=s.pos,i=s.pos+s.node.nodeSize,l=this.getAnnotationsBetween(e,a,i).map(e=>{let{id:n,pos:r}=e;return{id:n,newPos:r===o?t.mapping.map(r+1)-1:t.mapping.map(r)}});this.log("%c[Annotations] split card","color: green",{transaction:t,splitPos:o,parentEnd:i,toMove:l}),this.enqueueMoveInstructions(l)}handlePasteTransaction(e,t){if(!this.cutData&&!this.filmstripCutData)return;let n=t.steps.find(e=>"replace"===e.jsonID);if(!n)return;let{from:o,to:r,slice:{openStart:s}}=n,a=e.doc.resolve(n.from),i=r===o?o:o+1,l=null==a.nodeBefore&&a.parent.isBlock,d=!s||l;if(this.log("%c[Annotations] paste transaction","color: green",{transaction:t,insertPos:o,resolved:a,isPasteBeginning:l,pasteType:this.cutData?"cut":"filmstrip-cut"}),this.cutData){let e=this.cutData;this.cutData=null;let t=e.toMove.map(e=>{let{id:t,offset:n}=e;return{id:t,newPos:i+(d?n:Math.max(0,n))}});t&&t.length>0&&(this.log("[Annotations] paste from cut final move",t),this.enqueueMoveInstructions(t))}else if(this.filmstripCutData){let n=this.filmstripCutData;this.filmstripCutData=null;let o=i-1;for(;o<e.doc.nodeSize;){let t=e.doc.nodeAt(o);if(t&&(0,Q.jg)(t))break;o++}let r=this.getMoveInstructionsForFilmstripPaste(t,n,o);r&&r.length>0&&(this.log("[Annotations] paste from filmstrip cut final move",r),this.enqueueMoveInstructions(r))}}getMoveInstructionsForFilmstripPaste(e,t,n){if(!t)return;let o=(0,W.xe)(e.doc,Q.jg);if(!o)return;let r=e.doc.resolve(n).depth,s=o.filter(t=>{let{pos:n}=t;return e.doc.resolve(n).depth===r}),a=s.findIndex(e=>e.pos===n);if(-1===a)return;let i=s.slice(a);return t.flatMap(e=>{let{cardIndex:t,annotations:n}=e;return n.map(e=>{let{id:n,offset:o}=e,r=i[t];if(r)return{id:n,newPos:r.pos+o}}).filter(e=>!!e)})}handleFilmstripPaste(e,t,n){if(!this.cutData&&!this.filmstripCutData)return;let{insertPos:o}=n;if(this.cutData){let e=this.cutData;this.cutData=null;let n=e.toMove.map(e=>{let{id:t,offset:n}=e;return{id:t,newPos:o+n}});n&&n.length>0&&(this.log("[Annotations] filmstripPaste from cut final move",{tr:t,cutData:e,moveInstructions:n}),this.enqueueMoveInstructions(n))}else if(this.filmstripCutData){let e=this.filmstripCutData;this.filmstripCutData=null;let n=this.getMoveInstructionsForFilmstripPaste(t,e,o);n&&n.length>0&&(this.log("%c[Annotations] filmstripPaste from filmstrip cut final move","color: green",{tr:t,filmstripCutData:e,moveInstructions:n}),this.enqueueMoveInstructions(n))}}handleFilmstripCut(e,t,n){this.cutData=null,this.filmstripCutData=n.deleted.map(n=>{let{cardIndex:o,pos:r}=n,s=t.before.resolve(r),a=r+s.nodeAfter.nodeSize;return{cardIndex:o,annotations:this.getAnnotationsBetween(e,r,a).map(e=>{let{id:t,pos:n}=e;return{id:t,offset:n-r}})}}),this.log("%c[Annotations] filmstripCut","color: green",{tr:t,filmstripCutData:this.filmstripCutData})}handleCutTransaction(e,t){let n=t.steps.find(e=>"replace"===e.jsonID);if(!n)return;this.filmstripCutData=null;let{from:o,to:r}=n,s=e.doc.resolve(o),a=null==s.nodeAfter&&null==s.nodeBefore&&s.parent.isBlock,i=this.getAnnotationsBetween(e,o-!!a,r),l=i.map(t=>{let n=this.relToAbs(e,t.relativePos);return{id:t.id,offset:n-o}});this.cutData={slice:n.slice,toMove:l},this.log("%c[Annotations] cut transaction","color:green",{isWholeBlock:a,resolved:s,transaction:t,annotations:i,moveData:l})}handlePrependContentToBlock(e,t){let n=t.steps.find(e=>"replace"===e.jsonID);if(!n)return;let{from:o}=n,r=t.before.resolve(o);if(!r.nodeAfter)return;let s=this.getAnnotationsBetween(e,o,o+r.nodeAfter.nodeSize).map(n=>{let{id:r,relativePos:s}=n,a=this.relToAbs(e,s);return{id:r,newPos:a===o?t.mapping.map(a+1)-1:t.mapping.map(a)}});s.length>0&&(this.log("%c[Annotations] replace transaction - prepend content","color:green",{tr:t,annotationsToMove:s}),this.enqueueMoveInstructions(s))}handleReplaceTransaction(e,t){let n=t.steps.find(e=>"replace"===e.jsonID);if(!n)return;let{from:o,to:r}=n,s=t.before.resolve(o),a=t.before.resolve(r),i=s.parent!==a.parent,l=0==n.slice.content.size,d=0===s.parentOffset&&r>=o+s.parent.nodeSize-2,c=d&&l;if(0===a.parentOffset&&a.depth===s.depth+1&&a.pos-s.pos==1)return this.handlePrependContentToBlock(e,t);let u=!1;if(i){var p;let n=[...c?[]:this.getAnnotationsBetween(e,o-s.parentOffset-1,o).map(t=>{let{id:n,relativePos:o}=t;return{id:n,newPos:this.relToAbs(e,o)}}),...this.getAnnotationsBetween(e,r,r+(null==(p=a.nodeAfter)?void 0:p.nodeSize)+1).map(n=>{let{id:o,relativePos:r}=n;return{id:o,newPos:t.mapping.map(this.relToAbs(e,r))}})];this.log("[Annotations] multiline to move",n),n.length>0&&(u=!0,this.enqueueMoveInstructions(n))}let h=this.getAnnotationsBetween(e,o-(c||i&&0===s.parentOffset?1:0),r);h.length>0&&(u=!0,this.log("[Annotations] to delete",h),h.forEach(e=>{this.undoableMap.delete(e.id)})),u&&(this.log("%c[Annotations] replace transaction","color:green",{tr:t,annotationsToDelete:h,isWholeBlock:c,isMultiline:i,replacingEntireFromBlock:d,replacingWithNothing:l}),requestAnimationFrame(()=>{this.writeUndoStack(e)}))}handleReplaceAroundTransaction(e,t){let n=eJ()(t.steps.filter(e=>"replaceAround"===e.jsonID),t=>{let{from:n,to:o}=t;return this.getAnnotationsBetween(e,n,o)}),o=eK()(n,e=>e.id).map(e=>{let{id:n,pos:o}=e;return{id:n,newPos:t.mapping.map(o)}});return o.length>0&&this.log("%c[Annotations] replaceAround transaction","color:green",{tr:t,moveInsturctions:o}),0!==o.length&&(this.enqueueMoveInstructions(o),!0)}clearAnnotations(){this.transactYDoc(()=>{this.map.forEach((e,t)=>{this.map.delete(t)})})}restoreAnnotations(e){this.log("%c[Annotations] restoreAnnotations","color: green",e);let{toRestore:t}=e;this.clearAnnotations(),this.enqueueMoveInstructions(t.filter(e=>{let{absPos:t}=e;return null!=t}).map(e=>{let{absPos:t,id:n}=e;return{id:n,newPos:t}}))}addAnnotation(e,t){this.log("%c[Annotations] addAnnotation","color: green",e);let{pos:n,id:o,data:r}=e,s=this.absToRel(t,n);this.map.set(o,{id:o,pos:s,data:r})}deleteAnnotation(e){this.log("%c[Annotations] deleteAnnotation","color: green",e),this.map.delete(e)}moveAnnotations(e,t){let{map:n}=this;this.log("%c[Annotations] moveAnnotations","color: green",t),this.transactYDoc(()=>{t.forEach(t=>{let{id:o,newPos:r}=t,s=n.get(o)||{id:o};this.undoableMap.set(o,{...s,pos:this.absToRel(e,r)})})}),this.writeUndoStack(e)}writeUndoStack(e){let t=eN.Mj.getState(e).undoManager;if(0===t.undoStack.length)return;let n=this.undoableMap.flushUndoQueue();if(0===n.length)return;let o=t.undoStack[t.undoStack.length-1],r="annotations",s=o.meta.get(r)||[];s.length>0&&this.log("[Annotations] existing undo stack",{existing:s,toWrite:n,stack:t.undoStack});let a=[...n,...s];o.meta.set(r,a),this.log("[Annotations] writing to undo stack",a)}createDecorations(e){let{map:t}=this.options;this.refreshDecorations=!1;let n=[],r=[];t.forEach((t,s)=>{let a=(0,k.d_)(e,t.pos);if(null==a)return;let i=e.doc.nodeAt(a);i&&((null==i?void 0:i.isInline)?n.push(o.NZ.inline(a,a+1,{class:"debug-comment-cursor"})):n.push(o.NZ.node(a,a+i.nodeSize,{class:"debug-comment-block"}))),r.push({id:s,data:t.data,relativePos:t.pos,pos:a})}),e.doc.descendants((e,t,s)=>(!(t>0)||!!(0,eZ.cE)(s)||!!(0,eZ.cE)(e))&&(r.filter(n=>n.pos>=t&&n.pos<t+e.nodeSize).forEach(r=>{let{id:s,data:a}=r;n.push(o.NZ.node(t,t+e.nodeSize,{},{isAnnotation:!0,id:s,data:a}))}),!0)),this.decorations=o.zF.create(e.doc,n),this.annotations=r}handleDropAnnotations(e,t,n){let{dragging:{origNodePos:o,inBlock:r,inCard:s},droppedBlockPos:a}=n,i=[];r.forEach(e=>{let t=e.pos-o;i.push({id:e.id,newPos:a+t})}),this.getAnnotationsBetween(e,a,a+1).filter(e=>!i.find(t=>t.id===e.id)).forEach(e=>{i.push({id:e.id,newPos:t.mapping.map(e.pos)})}),s.filter(e=>!i.find(t=>t.id===e.id)).forEach(e=>{let n=t.mapping.map(e.pos);i.push({newPos:n,id:e.id})}),this.log("%c[Annotations] handleDropAnnotations","color: green",{action:n,tr:t,toMove:i}),i.length>0&&this.enqueueMoveInstructions(i)}handleLocalChange(e){let t=[...this.decorations.find(void 0,void 0,e=>e.isAnnotation&&this.moveInstructionMap[e.id])],n=this.decorations.remove(eq()(t)).map(e.mapping,e.doc).add(e.doc,t);return this.decorations=n,this}absToRel(e,t){let n=(0,k.JO)(e,t);if(!n)throw Error("Y.State non initialized");return n}relToAbs(e,t){return(0,k.d_)(e,t)}refreshRelativePos(e,t){let{doc:n,type:o,binding:r}=eN.pJ.getState(e),s=(0,eY.bL)(n,o,t,r.mapping);return(0,eY.Bw)(s,o,r.mapping)}enqueueMoveInstructions(e){e.forEach(e=>{this.moveInstructionMap[e.id]&&console.error("[AnnotationState] trying to enqueue two move instructions for annotation with targetId=".concat(e.id)),this.moveInstructionMap[e.id]=e})}enqueueRefreshDecorations(){this.refreshDecorations=!0}transactYDoc(e){this.options.document.transact(e)}log(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];M.of.get("debugComments")?console.log(...t):console.debug(...t)}constructor(e){this.options=e,this.decorations=o.zF.empty,this.annotations=[],this.refreshDecorations=!1,this.hasChanges=!1,this.filmstripCutData=null,this.cutData=null,this.moveInstructionMap={},this.map=e.map,this.restoreMap=e.restoreMap,this.undoableMap=new e$(this.map)}}let e0=e=>{let t=w()(e=>{eG.q.getState(e.state).persistRestoreMap(e.state)},500);return new A.k_({key:eG.q,state:{init:()=>new eX(e),apply:(e,t,n,o)=>t.apply(e,o)},view:()=>({update(e){t(e)}}),props:{transformPasted(t){var n;let o=this.getState(e.editor.state),r=null==(n=t.content.firstChild)?void 0:n.attrs.docId;return r&&r!==e.editor.gammaDocId&&o.clearCutData(),t},handleDOMEvents:{copy(e){return this.getState(e.state).clearCutData(),!1}},decorations(t){let{decorations:n,annotations:o}=this.getState(t);return e.onUpdate&&e.onUpdate(n.find().map(e=>new eH(e)),o),n}}})},e1=W.YY.create({name:"annotation",onCreate(){let e=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];M.of.get("debugComments")?console.log(...t):console.debug(...t)};this.options.document.on("afterAllTransactions",t=>{let n=eG.q.getState(this.editor.view.state),o=n.flushMoveInstructionQueue();o.length>0?(e("%c[Annotations] afterAllTransactions handling queued moves","color:pink",o),this.editor.commands.moveAnnotations(o)):n.refreshDecorations&&(e("%c[Annotations] afterAllTransactions refreshDecorations","color:pink"),queueMicrotask(()=>{this.editor.commands.refreshDecorations()}))});let t=eG.q.getState(this.editor.state);window.gammaAnnotations=t;let n=eN.Mj.getState(this.editor.state).undoManager;setTimeout(()=>{n.on("stack-item-popped",e=>{let o=e.stackItem.meta.get("annotations");if(!o)return void t.persistRestoreMap(this.editor.state,!0);let{undoStack:r,redoStack:s}=n;"undo"===e.type&&s.length>0?s[s.length-1].meta.set("annotations",eQ(o)):"redo"===e.type&&r.length>0&&r[r.length-1].meta.set("annotations",eQ(o)),t.restore(this.editor.state,o)})},0),t.map.observe(w()(()=>{e("[Annotations] map observe -> resfreshDecorations"),this.editor.commands.refreshDecorations()})),this.editor.commands.refreshDecorations()},addCommands:()=>({restoreAnnotations:e=>t=>{let{dispatch:n,tr:o}=t;return n&&(o.setMeta(eG.q,{type:"restoreAnnotations",toRestore:Object.values(e)}),n(o)),!0},updateAttributes:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return n=>{var o,r;let{tr:s,state:a,dispatch:i}=n,l=null,d=null,c=(o="string"==typeof e?e:e.name,(r=a.schema).nodes[o]?"node":r.marks[o]?"mark":null);return!!c&&("node"===c&&(l=(0,W.Pg)(e,a.schema)),"mark"===c&&(d=(0,W.I2)(e,a.schema)),i&&s.selection.ranges.forEach(e=>{let n=e.$from.pos,o=e.$to.pos;a.doc.nodesBetween(n,o,(e,r)=>{l&&l===e.type&&s.setNodeMarkup(r,void 0,{...e.attrs,...t}).setMeta("annotationEvent",{type:"update-node-attrs",pos:r}),d&&e.marks.length&&e.marks.forEach(a=>{if(d===a.type){let i=Math.max(r,n),l=Math.min(r+e.nodeSize,o);s.addMark(i,l,d.create({...a.attrs,...t}))}})})}),!0)}},wrapWithAnnotations:(e,t)=>n=>{let{state:o,tr:r,dispatch:s}=n,a=o.schema.nodes[e],{$from:i,$to:l}=o.selection,d=i.blockRange(l),c=d&&(0,eR.oM)(d,a,t);if(!c||!d)return!1;let{start:u,end:p}=d;return!s||(r.wrap(d,c).setMeta("annotationEvent",{type:"wrap-nodes",start:u,end:p,level:1}).scrollIntoView(),!0)},moveAnnotations:e=>t=>{let{dispatch:n,tr:o}=t;return n&&(o.setMeta(eG.q,{type:"moveAnnotations",toMove:e}),n(o)),!0},clearAnnotations:()=>e=>{let{dispatch:t,tr:n}=e;return t&&(n.setMeta(eG.q,{type:"clearAnnotations"}),t(n)),!0},refreshDecorations:()=>e=>{let{dispatch:t,tr:n}=e;return t&&(n.setMeta(eG.q,{type:"refreshAnnotationDecorations"}),t(n)),!0},addAnnotation:e=>{let{pos:t,id:n,data:o}=e;return e=>{let{dispatch:r,state:s}=e;return r&&s.tr.setMeta(eG.q,{type:"addAnnotation",id:n,data:o,pos:t}),!0}},deleteAnnotation:e=>t=>{let{dispatch:n,state:o}=t;return n&&o.tr.setMeta(eG.q,{type:"deleteAnnotation",id:e}),!0}}),addProseMirrorPlugins(){let{document:e,onUpdate:t}=this.options,n=new eF(e);return[e0({document:e,editor:this.editor,map:n.annotations,restoreMap:n.annotationsAbsolute,onUpdate:t})]}});var e3=n(36271);let e5=W.YY.create({name:"draftComments",addCommands:()=>({removeDraftComments:e=>t=>{let{dispatch:n,tr:o}=t;if(n){let t={type:"removeDraftComment",comments:Array.isArray(e)?e:[e]};o.setMeta(e3._,t),n(o)}return!0},createDraftComment:e=>t=>{let{dispatch:n,tr:o}=t;return n&&(o.setMeta(e3._,{type:"createDraftComment",comment:e}),n(o)),!0}}),addProseMirrorPlugins:()=>[(0,e3.h)()]});var e2=n(29608);let e6=new A.hs("mobileAnnotationPluginKey");class e4{apply(e,t){let n=e.getMeta(e6);return n&&"setPos"in n&&(this.pos=n.setPos),this}constructor(){this.pos=null}}let e8=W.YY.create({name:"mobileAnnotation",addCommands:()=>({setMobileAddBlockComment:e=>t=>{let{dispatch:n,tr:o,view:r}=t;if(!n)return!1;if(null===e)return o.setMeta(e6,{setPos:null}),n(o),!0;let{clientX:s,clientY:a}=e,i=r.posAtCoords({left:s,top:a});if(null===i)return!0;let l=(0,eZ.CS)(i.inside,r);if(!l)return!1;let d=r.coordsAtPos(l.pos),c=s-d.left,u=a-d.top;return o.setMeta(e6,{setPos:{pos:l.pos,end:l.end,offsetX:c,offsetY:u}}),n(o),!0}}),addProseMirrorPlugins(){var e;return[(e=this.editor,new A.k_({key:e6,state:{init:()=>new e4,apply:(e,t,n,o)=>t.apply(e,o)},props:{handleDOMEvents:{click(t,n){if(!(0,e2.Xb)())return!1;if(n.target.closest("[data-comments-wrapper]"))return;let o=e6.getState(t.state);o.pos||(o.timeout?(clearTimeout(o.timeout),o.timeout=null,e.commands.setMobileAddBlockComment(n)):o.timeout=setTimeout(()=>{o.timeout=null},300))}},decorations(e){let t=e6.getState(e).pos;if(null===t)return o.zF.empty;let n=o.NZ.node(t.pos,t.end,{},{isMobileAnnotation:!0,type:"show-buttons",offsetX:t.offsetX,offsetY:t.offsetY});return o.zF.create(e.doc,[n])}}}))]}});var e7=n(50764);let e9=W.YY.create({name:"BlockHover",addProseMirrorPlugins(){return[(0,e7.bA)(this.editor)]}});var te=n(48993),tt=n(95889),tn=n(74677);let to=W.YY.create({name:"editCardAI",onTransaction(e){var t;let{transaction:n}=e;if(!(!n.docChanged||n.getMeta("isEditCardVariant"))&&this.editor.isEditable&&M.of.get("editCard2"))if(null==(t=n.getMeta(eN.pJ))?void 0:t.isUndoRedoOperation)ts(n);else{if(!1===n.getMeta("addToHistory"))return;tr(n)}}}),tr=w()(e=>{try{let t=(0,E.KA)(),n=t.getState(),o=(0,te.yL)(n);if(0===Object.keys(o).length)return;(0,tn.A)(e).forEach(n=>{let r={from:n.newStart,to:n.newEnd},s=(0,W.Nx)(e.doc,r,e=>(0,Q.jg)(e)&&!!o[e.attrs.id]);s.length&&s.forEach(e=>{var n;let{node:r}=e,s=r.attrs.id;console.debug("Clearing suggestions for card",s),null===tt.zS||void 0===tt.zS||tt.zS.track(tt.VV.AI_CARD_VARIATION_KEPT,{cardId:s,variantId:o[s].selected,isOriginal:null==(n=o[s].variants.find(e=>e.id===o[s].selected))?void 0:n.isOriginal,interactionId:o[s].interactionId,source:"edit"}),t.dispatch((0,te.YB)({cardId:s}))})})}catch(e){console.error("[caught] EditCard clearSuggestions error",e)}},250),ts=e=>{try{let t=e.steps[0];if(!t||!(t instanceof eR.Ln))return;let n=t.slice.content,o=(0,E.KA)(),r=o.getState(),s=(0,te.yL)(r);if(0===Object.keys(s).length)return;n.descendants(e=>{if(!(0,Q.jg)(e))return;let t=e.attrs.id,n=s[t];if(!n)return;let r=n.variants.find(t=>JSON.stringify(t.card)===JSON.stringify(e.toJSON()));r&&o.dispatch((0,te.S6)({cardId:t,variantId:r.id}))})}catch(e){console.error("[caught] EditCard updateVariations error",e)}},ta=W.YY.create({name:"generateCard",addCommands:()=>({removeGeneratorInputsOnLoad:()=>e=>{let{tr:t,state:n,editor:o}=e;return!!o.isEditable&&((0,W.xe)(n.doc,e=>{var t;return(0,Q.jg)(e)&&(null==(t=e.attrs.generatorInput)?void 0:t.status)==="done"}).forEach(e=>{let{pos:n}=e;t.setNodeAttribute(n,"generatorInput",null)}),!0)}})});var ti=n(32380),tl=n(86083),td=n(38934);let tc=W.YY.create({name:"collaboration",priority:td.y.Collaboration,addOptions:()=>({document:null,field:"default",fragment:null}),onCreate(){this.editor.extensionManager.extensions.find(e=>"history"===e.name)&&console.warn('[tiptap warn]: "@tiptap/extension-collaboration" comes with its own history support and is not compatible with "@tiptap/extension-history".')},addCommands:()=>({undo:()=>e=>{let{tr:t,state:n,dispatch:o}=e;return t.setMeta("preventDispatch",!0),0!==eN.Mj.getState(n).undoManager.undoStack.length&&(!o||(0,ti.tN)(n)||!0)},redo:()=>e=>{let{tr:t,state:n,dispatch:o}=e;return t.setMeta("preventDispatch",!0),0!==eN.Mj.getState(n).undoManager.redoStack.length&&(!o||(0,ti.ZS)(n)||!0)}}),addKeyboardShortcuts(){return{"Mod-z":()=>this.editor.commands.undo(),"Mod-y":()=>this.editor.commands.redo(),"Shift-Mod-z":()=>this.editor.commands.redo()}},addProseMirrorPlugins(){let e=this.options.fragment?this.options.fragment:this.options.document.getXmlFragment(this.options.field);return[(0,tl.YZ)(e),(0,ti.$J)()]}}),tu=()=>new A.k_({key:new A.hs("undoHistoryPlugin"),appendTransaction(e,t,n){if(e.some(e=>!1==e.getMeta("addToHistory"))){let e=n.tr;return e.setMeta("addToHistory",!1),e}return null}}),tp=W.YY.create({name:"undoHistory",priority:td.y.UndoHistory,addProseMirrorPlugins:()=>[tu()],addCommands:()=>({noUndo:()=>e=>{let{tr:t}=e;return t.setMeta("addToHistory",!1),!0}})});var th=n(97481),tm=n.n(th),tg=n(33612),tf=n.n(tg);let ty=(e,t,n)=>{let o=e.resolve(t),r=e.resolve(n),s=o.nodeAfter,a=r.nodeBefore;return!!(s&&(0,Q.jg)(s)&&a&&(0,Q.jg)(a)&&s===a)};var tv=n(30963);let tb=(e,t,n)=>e!==t,tS=e=>{let t=document.createElement("span");t.classList.add("ProseMirror-yjs-cursor"),t.setAttribute("style","border-color: ".concat(e.color));let n=document.createElement("div");n.setAttribute("style","background-color: ".concat(e.color)),n.insertBefore(document.createTextNode(e.name),null);let o=document.createTextNode(""),r=document.createTextNode("");return t.insertBefore(o,null),t.insertBefore(n,null),t.insertBefore(r,null),t},tw=e=>({style:"background-color: ".concat(e.color,"70"),class:"ProseMirror-yjs-selection"}),tA=(e,t)=>(n,r,s,a)=>{let i=[];i.push(o.NZ.widget(a,()=>t(n),{key:r+"",side:10}));let l=tv.jk(s,a),d=tv.T9(s,a);return i.push(o.NZ.inline(l,d,e(n),{inclusiveEnd:!0,inclusiveStart:!1})),i},tM=/^#[0-9a-fA-F]{6}$/,tE=(e,t,n,r)=>{let s=eN.pJ.getState(e),a=s.doc,i=[];return null!=s.snapshot||null!=s.prevSnapshot||null===s.binding?o.zF.create(e.doc,[]):(t.getStates().forEach((t,o)=>{if(n(a.clientID,o,t)&&null!=t.cursor){let n=t.user||{};null==n.color?n.color="#ffa500":tM.test(n.color)||console.warn("A user uses an unsupported color format",n),null==n.name&&(n.name="User: ".concat(o));let l=(0,eY.bL)(a,s.type,g.sH(t.cursor.anchor),s.binding.mapping),d=(0,eY.bL)(a,s.type,g.sH(t.cursor.head),s.binding.mapping);if(null!==l&&null!==d){let t=tv.T9(e.doc.content.size-1,0);l=tv.jk(l,t),d=tv.jk(d,t),i.push(...r(e,n,o,l,d))}}}),o.zF.create(e.doc,i))},tx=function(e){let{awarenessStateFilter:t=tb,cursorBuilder:n=tS,selectionBuilder:o=tw,getSelection:r=e=>e.selection,createCursorDecorations:s=tA(o,n)}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"cursor";return new A.k_({key:eN.S6,state:{init:(n,o)=>tE(o,e,t,s),apply(n,o,r,a){let i=eN.pJ.getState(a),l=n.getMeta(eN.S6);return i&&i.isChangeOrigin||l&&l.awarenessUpdated?tE(a,e,t,s):o.map(n.mapping,n.doc)}},props:{decorations:e=>eN.S6.getState(e)},view:t=>{let n=()=>{t.docView&&(0,eY.iZ)(t,eN.S6,{awarenessUpdated:!0})},o=()=>{let n=eN.pJ.getState(t.state),o=e.getLocalState()||{};if(null!=n.binding)if(t.hasFocus()){let s=r(t.state),i=(0,eY.Bw)(s.anchor,n.type,n.binding.mapping),l=(0,eY.Bw)(s.head,n.type,n.binding.mapping);null!=o.cursor&&g.uG(g.sH(o.cursor.anchor),i)&&g.uG(g.sH(o.cursor.head),l)||e.setLocalStateField(a,{anchor:i,head:l})}else null!=o.cursor&&null!==(0,eY.bL)(n.doc,n.type,g.sH(o.cursor.anchor),n.binding.mapping)&&e.setLocalStateField(a,null)};return e.on("change",n),t.dom.addEventListener("focusin",o),t.dom.addEventListener("focusout",o),{update:o,destroy:()=>{t.dom.removeEventListener("focusin",o),t.dom.removeEventListener("focusout",o),e.off("change",n),e.setLocalStateField(a,null)}}}})},tk=()=>null,tC=e=>Array.from(e.entries()).map(e=>{let[t,n]=e;return{clientId:t,...n.user}}),tT=W.YY.create({name:"collaborationCursor",addOptions:()=>({provider:null,user:{name:null,color:null},render:e=>{let t=document.createElement("span");if(!e.isReady)return t;t.classList.add("collaboration-cursor__caret"),t.setAttribute("style","border-color: ".concat(e.color));let n=document.createElement("div");n.classList.add("collaboration-cursor__label"),n.setAttribute("style","background-color: ".concat(e.color,"; color: ").concat(tf()(e.color).isDark()?"white":"black"));let o=e.name.split(" ")[0];return n.insertBefore(document.createTextNode(o),null),t.insertBefore(n,null),t},buildSelection:e=>({style:"background-color: ".concat(e.color,"70"),class:"ProseMirror-yjs-selection"}),onUpdate:tk}),addStorage:()=>({users:[]}),addCommands(){return{user:e=>()=>(this.options.user=tm()({},this.options.user,e),this.options.provider.awareness.setLocalStateField("user",this.options.user),!0)}},addProseMirrorPlugins(){return[tx((this.options.provider.awareness.setLocalStateField("user",this.options.user),this.storage.users=tC(this.options.provider.awareness.states),this.options.provider.awareness.on("update",()=>{this.storage.users=tC(this.options.provider.awareness.states)}),this.options.provider.awareness),{createCursorDecorations:(e,t,n,r,s)=>{let a=[];if(ty(e.doc,r,s))return a;a.push(o.NZ.widget(s,()=>this.options.render(t),{key:n+"",side:10}));let i=r<s?r:s,l=r>s?r:s;return a.push(o.NZ.inline(i,l,this.options.buildSelection(t),{inclusiveEnd:!0,inclusiveStart:!1})),a}})]}});var tP=n(7915);let tD=W.YY.create({name:"globalDragHandle",priority:td.y.GlobalDragHandle,addOptions:()=>({scrollerSelector:"body"}),addStorage:()=>({enabled:!0}),addProseMirrorPlugins(){return[(0,tP.l)({editor:this.editor,storage:this.storage,scrollerSelector:this.options.scrollerSelector})]},extendNodeSchema(e){var t;return{containerHandle:null!=(t=(0,W.gk)((0,W.iI)(e,"containerHandle",e)))&&t}}});var tI=n(1739),tz=n(40076),t_=n(4765);let tN=new A.hs("erasingContent");class tR{toJSON(){return{datetime:this.timestamp.toISOString(),meta:this.tr.meta,steps:this.tr.steps.map(e=>e.toJSON())}}constructor(e){this.tr=e,this.timestamp=new Date(new Date().toLocaleString("en-US",{timeZone:"America/Los_Angeles"}))}}class tO{apply(e,t){return e.docChanged&&(this.transactions.unshift(new tR(e)),this.transactions.length>5&&this.transactions.pop()),this}constructor(){this.transactions=[]}}class tj extends Error{constructor(e){super(e||"Content erased"),this.name="ContentErasedError"}}let tL=W.YY.create({name:"ErasingContent",addProseMirrorPlugins(){let e=this,t=t=>{try{var n;let o=(0,Y.HW)();for(let t of this.options.messageLogger.flushMessages()){let n={...t.toDebugObject(),clientID:e.options.provider.document.clientID};tz.yf.logger.info(t.toString(),n),console.log(t.toString(),n)}let r=Math.floor(performance.now()-this.options.startTime),s={event:"CONTENT_ERASED",didFilterTransaction:t.didFilterTransaction,tr:t.tr.toJSON(),prevTrs:null==(n=t.prevTrs)?void 0:n.map(e=>e.toJSON()),timeSinceOpened:r,isBackgrounded:!!document.hidden,docId:this.options.provider.configuration.name,clientID:this.options.provider.document.clientID,userId:null==o?void 0:o.id};tz.yf.logger.error("[ErasingContent] ".concat(r," content erased (FILTERED: ").concat(t.didFilterTransaction,")"),s),t_.Cp(new tj)}catch(e){console.error("Failed to log content erased",e),t_.Cp(e)}};return[new A.k_({key:tN,filterTransaction:(e,n)=>{if(!e.docChanged)return!0;let o=n.doc.type.createAndFill().content;if(null===e.doc.content.findDiffStart(o)){let o=new tR(e),r=tN.getState(n),s=M.of.get("filterContentErasingTrs");return t({tr:o,didFilterTransaction:s,prevTrs:null==r?void 0:r.transactions}),!s}return!0},state:{init:()=>new tO,apply:(e,t,n,o)=>t.apply(e,o)}})]}});var tB=n(86932),tF=n(64084);let tH=W.YY.create({name:"filmstrip",onCreate(){let e=eN.Mj.getState(this.editor.state).undoManager;e.on("stack-item-popped",t=>{let{undoStack:n,redoStack:o}=e,r=t.stackItem.meta.get("filmstripState");if(!r)return;let s=(0,tF.Tz)((0,E.KA)().getState());"undo"===t.type&&o.length>0?o[o.length-1].meta.set("filmstripState",s):"redo"===t.type&&n.length>0&&n[n.length-1].meta.set("filmstripState",s),(0,E.KA)().dispatch((0,tF.Uy)(r))})}});var tG=n(2426),tY=n(24037);class tU{initialize(e){let{element:t,tippyTarget:n,tippyOptions:o}=e;if(!t||!n)return void console.warn("[BubbleMenuView] initialize. No element provided");this.element=t,this.target=n,this.editor.on("focus",this.focusHandler),this.editor.on("blur",this.blurHandler),this.createTooltip(o),this.element.style.visibility="visible"}createTooltip(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,n=t||this.view.dom.parentElement;n&&this.element&&(this.tippy=(0,eS.Ay)(n,{duration:0,getReferenceClientRect:null,content:this.element,interactive:!0,trigger:"manual",placement:"bottom",hideOnClick:"toggle",offset:[0,5],...e}),this.tippy.popper.firstChild&&this.tippy.popper.firstChild.addEventListener("blur",this.tippyBlurHandler))}update(e){let t=tY.X.getState(e.state);if(!this.element||!this.target){if(!t.element||!t.tippyTarget)return;this.initialize(t)}let n=t.getNodePos();if(!n)return void this.hide();this.show(n)}show(e){var t,n;let o=this.editor.view.state.doc.nodeAt(e),r=o?(0,ew.KQ)(o):"ltr";null==(t=this.tippy)||t.setProps({getReferenceClientRect:()=>(0,W.MG)(this.editor.view,e,e),placement:"rtl"===r?"bottom-start":"bottom-end"}),null==(n=this.tippy)||n.show()}hide(){var e;this.onHide&&"function"==typeof this.onHide&&this.onHide(),null==(e=this.tippy)||e.hide()}destroy(){var e,t;(null==(e=this.tippy)?void 0:e.popper.firstChild)&&this.tippy.popper.firstChild.removeEventListener("blur",this.tippyBlurHandler),null==(t=this.tippy)||t.destroy(),this.editor.off("focus",this.focusHandler),this.editor.off("blur",this.blurHandler)}constructor({editor:e,view:t}){this.element=null,this.target=null,this.getNodePos=()=>null,this.preventHide=!1,this.onHide=()=>{},this.focusHandler=()=>{setTimeout(()=>this.update(this.view))},this.blurHandler=e=>{var t,n;let{event:o}=e;if(this.preventHide){this.preventHide=!1;return}(null==o?void 0:o.relatedTarget)&&(null==(n=this.element)||null==(t=n.parentNode)?void 0:t.contains(o.relatedTarget))||(null==o?void 0:o.relatedTarget)!==this.editor.view.dom&&this.hide()},this.tippyBlurHandler=e=>{this.blurHandler({event:e})},this.editor=e,this.view=t}}let tq=W.YY.create({name:"gammaBubbleMenu",addCommands:()=>({forceHideGammaBubbleMenu:e=>t=>{let{tr:n}=t;return n.setMeta(tY.X,{forceHide:e}),!0}}),addProseMirrorPlugins(){let{editor:e}=this;return[new A.k_({key:tY.X,state:{init:()=>({element:null,tippyTarget:null,forceHide:!1,getNodePos:()=>null,tippyOptions:{}}),apply(e,t){let n=e.getMeta(tY.X);return n?{...t,...n}:t}},view:t=>new tU({view:t,editor:e})})]}});var tV=n(43028),tJ=n(45574),tW=n(2320);let tK=W.YY.create({name:"scrollMargin",addProseMirrorPlugins:()=>[new A.k_({props:{scrollMargin:T.E0,scrollThreshold:T.E0}})]});var tZ=n(25600),tQ=n(25105),t$=n(27196),tX=n(14753),t0=n(43634),t1=n(51817),t3=n(12514),t5=n(40452),t2=n(74676),t6=n(21157),t4=n.n(t6),t8=n(80911);let t7=e=>{let{editor:t}=e,[n,o]=(0,h.useState)(null);(0,h.useEffect)(()=>{if(!t)return;let e=()=>{o(t.state.selection)};return e(),t.on("selectionUpdate",e),()=>{t.off("selectionUpdate",e)}},[t]);let s=n instanceof A.nh,a=n instanceof t8.J,l=t4()((null==n?void 0:n.toJSON().type)||"none"),d=t4()(s&&(null==n?void 0:n.node.type.name)||""),c=a?void 0:s?"blue":"green";return(0,r.jsx)(t3.Z,{children:(0,r.jsx)(t5.s,{className:"selection-debugger",position:"absolute",top:"50px",left:"10px",zIndex:"999999",children:(0,r.jsxs)(i.B,{direction:"column",children:[(0,r.jsxs)(t2.E,{colorScheme:c,children:[l,d&&(0,r.jsxs)("i",{children:[" (",d,")"]})]}),n&&(0,r.jsxs)(t2.E,{colorScheme:"gray",children:["f:",n.from," - t:",n.to,a&&" | side:".concat(n.side)]})]})})})};var t9=n(58495),ne=n(74158),nt=n(68986),nn=n(65148);let no=(0,t9.d_)("1234567890",10),nr=()=>{let e=nt.e.getItem(nn.E.sessionId);if(e)return e;let t="".concat(+new Date,"__").concat(no());return nt.e.setItem(nn.E.sessionId,t),t},ns=(e,t)=>{let{user:n,isUserLoading:o,anonymousUser:r,color:s}=(0,Y.ur)(),a=(0,h.useRef)(!1),i=(0,ne.wA)(),l=(0,h.useMemo)(()=>nr(),[]),d=(0,E.GV)(t0.l$),c=(0,h.useMemo)(()=>({id:(null==n?void 0:n.id)||r.id,color:s.value,sessionId:d?l+"__pv":l,isPresenterView:d,idleSince:null,name:(null==n?void 0:n.displayName)||r.displayName||"",profileImageUrl:(null==n?void 0:n.profileImageUrl)||"",isReady:!o,spotlight:{pos:null,cardId:null}}),[n,s,o,d,r,l]);(0,h.useEffect)(()=>{if(!e||e.isDestroyed||!(null==t?void 0:t.awareness))return;e.commands.user(c),!a.current&&c.isReady&&(e.chain().blur().focusDelayed().run(),a.current=!0),i((0,t0.vK)({sessionId:c.sessionId}));let n=(e,n)=>{let{added:o,updated:r,removed:s}=e;requestIdleCallback(()=>{if(!t.awareness)return;let e=tC(t.awareness.states);i((0,t0._)({collaborators:e}))},{timeout:500})};t.awareness.on("change",n);let o=w()(n,t0.Y5);return t.awareness.on("update",o),()=>{var e,r;null==(e=t.awareness)||e.off("change",n),null==(r=t.awareness)||r.off("update",o)}},[c,e,t,i]),(0,h.useEffect)(()=>{if(!e)return;let t=w()(t=>{e.commands.user(t)},10);return(0,E.oM)(t0.kM,t)},[e])};var na=n(96284),ni=n(22448),nl=n(10612),nd=n.n(nl);let nc=e=>JSON.stringify(Array.from(e.entries())),nu=e=>JSON.stringify(Array.from(e)),np=e=>Array.from(e.entries()),nh=e=>e instanceof g.q7?{__type:e.constructor.name,id:e.id,length:e.length,info:e.info,parent:e.parent,parentSub:e.parentSub,content:{__type:e.content.constructor.name,...e.content}}:e,nm=()=>{let e=(0,ni.xv)();return(0,ni.Qj)(e,""),(0,ni.zd)(e,u.Go.Sync),(0,ni.zd)(e,1),(0,ni.Gu)(e,new Uint8Array([])),(0,ni.Fo)(e)};class ng{setTransaction(e){this.transaction=e}shouldAssociateTransaction(){return!1}getPayload(){return{}}toString(){let e="in"===this.dir?"\uD83D\uDFE9":"\uD83D\uDFE6",t=nd()(String(this.timestamp),5);return"".concat("[HocuspocusMessage]"," ").concat(t," ").concat(e," ").concat(this.typeName)}toDebugObject(){var e;return{event:"hocuspocus-message",docId:this.docId,userId:null==(e=(0,ec.HW)())?void 0:e.id,hocuspocusMessage:{dir:this.dir,timestamp:this.timestamp,typeName:this.typeName,messageType:this.messageType,payload:this.getPayload()}}}static fromOutgoingMessage(e,t){let n=0===e.encoder.cpos&&0===e.encoder.bufs.length?nm():(0,ni.Fo)(e.encoder);return ng.fromData("out",n,t)}static fromIncomingMessage(e,t){return ng.fromData("in",new Uint8Array(e),t)}static fromData(e,t,n){let o=(0,na.$C)(t),r=(0,na.t3)(o);switch((0,na.cw)(o)){case u.Go.Sync:return new nf(r,e,o,n);case u.Go.Awareness:return new ny(r,e,o,n);case u.Go.Auth:return new nv(r,e,o,n);case u.Go.QueryAwareness:return new nb(r,e,o,n);case u.Go.Stateless:return new nS(r,e,o,n);case u.Go.CLOSE:return new nw(r,e,o,n);case u.Go.SyncStatus:return new nA(r,e,o,n);default:return new ng(r,e,n)}}constructor(e,t,n){this.docId=e,this.dir=t,this.timestamp=n,this.messageType=null,this.typeName="DebugHocuspocusMessage",this.transaction=null}}class nf extends ng{getPayload(){let{transaction:e}=this,t=null,n=null;if(0===this.syncStep){var o;o=this.update,t=JSON.stringify(np(g.Zx(o)))}else this.syncStep>0&&(n=function(e){try{let t=g.W3(new Uint8Array(e));return{ds:JSON.stringify(np(t.ds.clients)),structs:JSON.stringify(t.structs.map(nh))}}catch(e){return{}}}(this.update));let r={syncStepName:this.syncStepName,syncStep:this.syncStep,update:nu(this.update),stateVector:t,decodedUpdate:n,transaction:null};return null!==e&&(r.transaction={beforeState:nc(e.beforeState),beforeStateSize:e.beforeState.size,afterState:nc(e.afterState),afterStateSize:e.afterState.size,changed:nc(e.changed),changedSize:e.changed.size,deleteSet:nc(e.deleteSet.clients),deleteSetSize:e.deleteSet.clients.size}),r}shouldAssociateTransaction(){return 2===this.syncStep}toString(){let e=super.toString();return"".concat(e," [step=").concat(this.syncStepName,"]")}constructor(e,t,n,o){super(e,t,o),this.messageType=u.Go.Sync,this.typeName="Sync",this.syncStep=(0,na.cw)(n),this.syncStepName=0===this.syncStep?"SyncStep1":1===this.syncStep?"SyncStep2":"Update",this.update=(0,na.bo)(n)}}class ny extends ng{getPayload(){return{len:this.states.length,states:this.states}}constructor(e,t,n,o){super(e,t,o),this.messageType=u.Go.Awareness,this.typeName="Awareness",this.states=[];let r=(0,na.bo)(n),s=(0,na.$C)(r),a=(0,na.cw)(s);for(let e=0;e<a;e++){let e=(0,na.cw)(s),t=(0,na.cw)(s),n=(0,na.t3)(s);this.states.push({clientId:e,clock:t,state:n})}}}class nv extends ng{getPayload(){return{authMessageType:this.authMessageTypeName,scope:this.scope}}toString(){let e=super.toString();return"".concat(e," [authType=").concat(this.authMessageTypeName,"]")}constructor(e,t,n,o){super(e,t,o),this.messageType=u.Go.Auth,this.typeName="Auth",this.authMessageType=(0,na.cw)(n),this.authMessageTypeName=0===this.authMessageType?"Token":1===this.authMessageType?"PermissionDenied":"Authenticated",this.scope=(0,na.t3)(n)}}class nb extends ng{constructor(e,t,n,o){super(e,t,o),this.messageType=u.Go.QueryAwareness,this.typeName="QueryAwareness"}}class nS extends ng{constructor(e,t,n,o){super(e,t,o),this.messageType=u.Go.Stateless,this.typeName="Stateless"}}class nw extends ng{constructor(e,t,n,o){super(e,t,o),this.messageType=u.Go.CLOSE,this.typeName="Close"}}class nA extends ng{getPayload(){return{saved:this.saved}}constructor(e,t,n,o){super(e,t,o),this.messageType=u.Go.SyncStatus,this.typeName="SyncStatus",this.saved=1===(0,na.cw)(n)}}let nM=()=>{let e=(0,h.useRef)(null);return{onTransaction:(0,h.useCallback)(t=>{e.current=t},[]),getTransaction:(0,h.useCallback)(()=>{let t=e.current;return e.current=null,t},[])}};class nE{onMessage(e){e.messageType!==u.Go.Awareness&&(this.buffer.push(e),this.buffer.length>this.bufferSize&&this.buffer.shift())}getMessages(){return this.buffer}flushMessages(){let e=this.buffer;return this.buffer=[],e}constructor(e=50){this.bufferSize=e,this.buffer=[]}}var nx=n(50333),nk=n.n(nx);let nC=e=>{let[t,n]=(0,h.useState)([]);return{logMessages:t,logPerfMessage:(0,h.useCallback)(t=>{if(!e)return;let o=performance.now(),r={msg:t,timestamp:o};n(e=>0===e.length?[...e,r]:e.find(e=>e.msg===t)||e[e.length-1].msg===t?e:(r.duration=nk()(o-e[e.length-1].timestamp,2),[...e,r]))},[e]),dumpLog:(0,h.useCallback)(()=>{e&&n(e=>{try{console.table(e)}catch(e){}return[]})},[e])}};var nT=n(58959),nP=n(80314),nD=n(46898),nI=n(19564),nz=n(99038),n_=n(37605);let nN="not-connecting-toast",nR=()=>{let e="dev"===f.$.APPLICATION_ENVIRONMENT||"staging"===f.$.APPLICATION_ENVIRONMENT;return(0,r.jsx)(t5.s,{direction:"column",p:4,color:"white",bg:"yellow.500",borderRadius:"md",children:(0,r.jsxs)(t5.s,{alignItems:"center",children:[(0,r.jsx)(l.y,{mr:4}),(0,r.jsxs)(s.a,{ml:3,children:[(0,r.jsx)(d.E,{lineHeight:6,fontSize:"sm",fontWeight:"bold",children:(0,r.jsx)(nI.x6,{id:"9tGBiL",values:{GAMMA_ARTIFACT_PROPER_NOUN:nz.TP}})}),(0,r.jsx)(d.E,{lineHeight:6,fontSize:"sm",children:(0,r.jsx)(nI.x6,{id:"xpqx+T"})}),e&&(0,r.jsx)(nT.z,{children:(0,r.jsxs)(nP.N,{href:"https://github.com/gamma-app/gamma/blob/main/packages/client/src/modules/tiptap_editor/CollaborativeEditor/DEBUG_NOT_CONNECTING_TOAST.md",color:"deepocean.500",children:[(0,r.jsx)(t2.E,{colorScheme:"orange",fontSize:"xxs",me:1,children:"Gamma Only"}),"Debug Developer Connection Issues"]})})]})]})})},nO=e=>{let{enabled:t,docId:n}=e,o=(0,nD.d)(),r=(0,h.useRef)(null),s=(0,h.useCallback)(()=>{o.close(nN),r.current&&(clearTimeout(r.current),r.current=null)},[o]);return(0,h.useEffect)(()=>{if(t)return r.current=setTimeout(()=>{o.isActive(nN)||(o({render:nR,duration:null,id:nN}),tz.yf.logger.info("Editor slow load toast shown",{event:n_.ng.EDITOR_SLOW_LOAD,docId:n}))},15e3),()=>{r.current&&(clearTimeout(r.current),r.current=null)}},[n,t,o]),s};var nj=n(12733),nL=n(67604),nB=n(81141),nF=n(88586),nH=n(25991),nG=n(86497);let nY=e=>{let t=(0,nL.A)(e),n=new Date;return 4>=Math.abs((0,nB.A)(n,t))},nU=(e,t)=>{let[n,o]=(0,h.useState)(!1),r=(0,h.useRef)(null);(0,h.useEffect)(()=>{if(t){r.current&&clearTimeout(r.current),o(!1);return}return r.current=setTimeout(()=>{o(!0)},1e4),()=>{r.current&&clearTimeout(r.current)}},[t]);let s=(0,E.GV)(nH.TT)[e];if(!s)return!1;let a=s.lastSynced;return!!(a&&nY(a))||n},nq=(e,t)=>{let{isInOfflineMode:n}=(0,nF.utY)(),o=(0,nG.O)(),r=(0,E.GV)(nH.yy),s=nU(e,t);return n||(o||r)&&s};var nV=n(96500),nJ=n(64268),nW=n(51504),nK=n(5221),nZ=n(99745),nQ=n(77364),n$=n(51684),nX=n(48621),n0=n(65905);let n1=()=>!!window.navigator&&!1===window.navigator.onLine,n3=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3e4,[t,n]=(0,h.useState)(n1),o=(0,h.useRef)(null);return(0,n0.LQ)("offline",()=>{o.current=setTimeout(()=>{n(!0)},e)}),(0,n0.LQ)("online",()=>{o.current&&(clearTimeout(o.current),o.current=null),n(!1)}),t};var n5=n(14900),n2=n(43607),n6=n(69138),n4=n(29238);let n8=async(e,t,n,o)=>{try{let{id:r,length:s}=n||{},a=await fetch("".concat(f.$.MULTIPLAYER_WS_URL.replace("wss","https"),"/").concat(e,"/verify/").concat(t),{method:"POST",mode:"cors",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({id:r,length:s,clientCount:null==o?void 0:o.clientCount,totalCount:null==o?void 0:o.totalCount})});return await a.json()}catch(e){}},n7=e=>{let t=e.document.store.clients.get(e.document.clientID);if(t&&t.length)return t[t.length-1]},n9=e=>({clientCount:e.document.store.clients.size,totalCount:[...e.document.store.clients.values()].reduce((e,t)=>e+t.reduce((e,t)=>e+t.length,0),0)}),oe=async(e,t,n)=>{let o=n7(t),r=n9(t),s=await n8(e.gammaDocId,t.document.clientID,o,r);if(!s)return console.warn("[compareClocks] Failed to fetch remote clock"),!1;try{var a;let e=((null==o?void 0:o.id.clock)||0)+((null==o?void 0:o.length)||0),t=((null==s||null==(a=s.lastKnownItem.id)?void 0:a.clock)||0)+((null==s?void 0:s.lastKnownItem.length)||0),i=e-t;i>0&&console.warn("[compareClocks] Clock drift detected",{diffLastItem:i});let l=r.clientCount-(s.itemSummary.clientCount||0),d=r.totalCount-(s.itemSummary.totalCount||0);return l>0&&console.warn("[compareClocks] clientCount drift detected",{diffClientCount:l}),d>0&&console.warn("[compareClocks] totalCount drift detected",{diffTotalCount:d}),0===l&&d<=n&&i<=n}catch(e){console.warn("[compareClocks] Failed to fetch remote clock")}return!1},ot=e=>{let[t,n]=(0,h.useState)(null==e?void 0:e.status);return(0,h.useEffect)(()=>{if(!e)return;let t=e=>{let{status:t}=e;n(t)};return e.on("status",t),()=>{e.off("status",t)}},[e]),t},on=e=>{let{editor:t,yProvider:n,enabled:o}=e,r=(0,E.CU)(),[s,a]=(0,h.useState)(Date.now()),[i,l]=(0,h.useState)(0),d=ot(n),[c,u]=(0,h.useState)(o);(0,h.useEffect)(()=>{if(!o)return void u(!1);u(!1);let e=m.wg(()=>{u(!0)},5e3);return()=>{m.DJ(e)}},[o,d]);let p=(0,M.u)("dataSyncClockDriftTolerance"),g=(0,h.useCallback)(async()=>{if(!t||!n||!t.gammaDocId)return;let{online:e,backgrounded:o}=(0,n4.mN)(r.getState());e&&!o&&(await oe(t,n,p)?(l(0),a(Date.now())):(l(e=>e+1),console.warn("[useDataPersistenceSync_2] Clocks out of sync for doc",t.gammaDocId)))},[p,t,r,n]),f=0===i?2e4:4e3;return(0,h.useEffect)(()=>{if(!t||!n||!c)return;let e=setInterval(()=>{g()},f);return()=>{e&&clearInterval(e)}},[t,n,c,f,p,g]),{errorCount:i,yDocLastSynced:s,checkDataInSync:g}},oo="data-sync-error-toast",or="data-sync-not-saved-toast",os=(0,r.jsx)(nX.g,{icon:n$.lEd,size:"2x"}),oa=(0,r.jsx)(nX.g,{icon:n$.JAe,size:"2x"}),oi=e=>{let{type:t,yDocLastSynced:n}=e;return()=>(0,r.jsx)(t5.s,{direction:"column",p:4,color:"white",bg:"warn"===t?"yellow.500":"red.500",borderRadius:"md",children:(0,r.jsxs)(t5.s,{alignItems:"center",children:["warn"===t?os:oa,(0,r.jsxs)(s.a,{ml:3,children:[(0,r.jsx)(d.E,{lineHeight:6,fontSize:"sm",fontWeight:"bold",children:"warn"===t?(0,r.jsx)(nI.x6,{id:"BM8j3v",values:{GAMMA_PROPER_NOUN:nz.On}}):(0,r.jsx)(nI.x6,{id:"DgKz0c",values:{GAMMA_PROPER_NOUN:nz.On}})}),n&&(0,r.jsx)(d.E,{lineHeight:6,fontSize:"sm",children:(0,r.jsx)(nI.x6,{id:"VxWwaW",values:{0:(0,n5.Bo)(new Date(n).toISOString())}})}),"error"===t&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(nV.c,{pt:2}),(0,r.jsx)(d.E,{lineHeight:6,fontSize:"sm",pt:2,children:(0,r.jsx)(nI.x6,{id:"Pw5K5r"})})]})]})]})})},ol=e=>{let{onClose:t}=e;return(0,r.jsxs)(nJ.F,{status:"info",colorScheme:"gray",alignItems:"start",borderRadius:"md",boxShadow:"lg",paddingEnd:8,textAlign:"start",width:"auto",children:[(0,r.jsx)(nW._,{}),(0,r.jsxs)(s.a,{flex:"1",maxWidth:"100%",children:[(0,r.jsx)(nK.X,{children:(0,r.jsx)(nI.x6,{id:"BM8j3v",values:{GAMMA_PROPER_NOUN:nz.On}})}),(0,r.jsx)(nZ.T,{display:"block",children:(0,r.jsx)(nI.x6,{id:"I1QCnH"})})]}),(0,r.jsx)(nQ.J,{size:"sm",onClick:t,position:"absolute",insetEnd:1,top:1})]})},od=e=>{let{enabled:t,errorCount:n,errorCountThreshold:o,isPresentModeAndNotEditing:r,background:s,offline:a}=e;return!t||r||s||a||-1===o?"ignored":n>2*o?"error":n>o?"warn":"ok"},oc=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:15e3,[t,n]=(0,h.useState)(!0),o=(0,h.useRef)(null);return(0,n0.LQ)("foreground",t=>{let{timeInBackground:r}=t;if(null===r)return void n(!0);if(r>6e4){o.current=setTimeout(()=>{n(!0)},e);return}n(!0)}),(0,n0.LQ)("background",()=>{o.current&&(clearTimeout(o.current),o.current=null),n(!1)}),t},ou=e=>{let{offline:t,yDocLastSynced:n}=e,o=(0,nD.d)(),[s,a]=(0,h.useState)(!1),i=(0,nG.O)(),l=(0,E.GV)(nH.yy),d=(i||l)&&!t;return(0,h.useMemo)(()=>({warnOrError:e=>{if(d)return!o.isActive(or)&&!s&&(o({id:or,duration:null,render:e=>{let{onClose:t}=e;return ol({onClose:()=>{t(),a(!0)}})}}),!0);let t=oi({type:e,yDocLastSynced:n});return o.isActive(oo)?(o.update(oo,{render:t}),!1):(o({render:t,duration:null,id:oo}),!0)},recovered:e=>!!(d?o.isActive(or)||s:o.isActive(oo))&&((o.isActive(oo)||o.isActive(or))&&o.closeAll(),"ignored"!==e&&(d&&(o({title:(0,r.jsx)(nI.x6,{id:"flElqq",values:{GAMMA_PROPER_NOUN:nz.On}}),description:(0,r.jsx)(nI.x6,{id:"Gm5OG1"}),status:"success",duration:5e3,id:"data-sync-saved-toast",isClosable:!0}),a(!1)),!0))}),[s,o,d,n])},op=e=>{let{editor:t,yProvider:n,enabled:o}=e,r=(0,E.GV)(t0.VJ),s=(0,n2.UT)("comment"),a=(0,E.GV)(t0.jn),i=(0,tt.st)(),{user:l}=(0,Y.ur)(),d=(0,h.useRef)(void 0),c=(0,M.u)("dataSyncErrorThreshold"),{errorCount:u,yDocLastSynced:p}=on({editor:t,yProvider:n,enabled:o&&s}),m={docSavedTime:a,yDocLastSynced:p,errorCount:u,clientID:null==n?void 0:n.document.clientID,userId:null==l?void 0:l.id},g=(0,h.useRef)(m);g.current=m;let f=n3(),y=oc(),v=(0,h.useRef)(void 0);v.current={errorCount:u,enabled:o,errorCountThreshold:c,isPresentModeAndNotEditing:r,background:!y,offline:f};let b=od(v.current),S=ou({offline:f,yDocLastSynced:p});return(0,n6.V)(()=>{if("ok"===b||"ignored"===b){if(!S.recovered(b))return;let e=d.current?new Date-d.current:void 0;null==i||i.trackDocEvent(tt.ng.DATA_SYNC_RECOVER,{...g.current,duration:e}),tz.yf.logger.info("Data sync recovered",{event:tt.ng.DATA_SYNC_RECOVER,docId:null==t?void 0:t.gammaDocId,errorStatusInput:v.current,docEventData:g.current}),d.current=void 0;return}S.warnOrError(b)&&(null==i||i.trackDocEvent(tt.ng.DATA_SYNC_ERROR,g.current),tz.yf.logger.info("Data sync error",{event:tt.ng.DATA_SYNC_ERROR,docId:null==t?void 0:t.gammaDocId,dataSyncErrorType:b,errorStatusInput:v.current,docEventData:g.current}),"error"===b&&t_.Cp("[useDataPersistenceSync] ERROR_THRESHOLD_EXCEEDED. docId: ".concat(null==t?void 0:t.gammaDocId)))},[i,null==t?void 0:t.gammaDocId,b,S],[b]),"error"===b},oh=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e3,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5,n=(0,h.useRef)(0),o=(0,h.useRef)(0),[r,s]=(0,h.useState)(!1),[a,i]=(0,h.useState)(0),[l,d]=(0,h.useState)(document.hidden),c=(0,h.useRef)(()=>{n.current++,n.current>=t&&(console.warn("[useRateLimiter] Limit hit! (".concat(t," per ").concat(e/1e3,"s)")),r||(s(!0),i(e=>e+1))),o.current||(o.current=m.yb(()=>{n.current>0?n.current--:(s(!1),m.vG(o.current),o.current=0)},e/t))});return(0,h.useEffect)(()=>{let e=()=>{d(document.hidden),c.current()};return document.addEventListener("visibilitychange",e),()=>document.removeEventListener("visibilitychange",e)},[]),[c.current,r,a,l]};var om=n(57405),og=n(49611);let of=()=>(0,r.jsxs)(om.T,{align:"flex-end",borderRadius:"base",shadow:"lg",p:3,bg:"gray.50",spacing:4,maxW:"300px",direction:"row",children:[(0,r.jsxs)(s.a,{children:[(0,r.jsx)(d.E,{fontSize:"md",fontWeight:"bold",children:(0,r.jsx)(nI.x6,{id:"8kh5VW",values:{GAMMA_PROPER_NOUN:nz.On}})}),(0,r.jsxs)(d.E,{fontSize:"sm",children:[(0,r.jsx)(nI.x6,{id:"CDva2g"})," ",(0,r.jsx)("em",{children:(0,r.jsx)(nI.x6,{id:"/vuJlA"})})," ","\uD83D\uDE0E"]})]}),(0,r.jsx)(s.a,{children:(0,r.jsx)(og.$,{size:"sm",onClick:()=>{window.location.reload()},children:(0,r.jsx)(nI.x6,{id:"HpK/8d"})})})]}),oy=e=>{let t=(0,nD.d)(),[n,o]=(0,h.useState)(!1);return(0,h.useEffect)(()=>{if(!e)return;let t=()=>{let t=e.getMap("SCHEMA_VERSION").get("REQUIRED_VERSION"),n=!!(t&&t>t1.f$);o(n),console[n?"warn":"debug"]("[SchemaVerifier] onUpdate",{requiredVersion:t,MY_VERSION:t1.f$,outdated:n})};return e.on("update",t),()=>{e.off("update",t)}},[e]),(0,h.useEffect)(()=>{n&&!t.isActive("schema_outdated")&&t({id:"schema_outdated",duration:null,status:"warning",isClosable:!1,position:"bottom-left",render:of})},[n,t]),n},ov="staging"===f.$.APPLICATION_ENVIRONMENT&&f.$.API_HOST.endsWith("api-custom-backend.staging.gamma.app"),ob=e=>({DOC_ID:e,SCHEMA_VERSION:String(t1.f$),SHARE_TOKEN:f.$.SHARE_TOKEN,...ov?{API_HOST:f.$.API_HOST}:{}}),oS=(0,h.memo)(e=>{let{doc:t,docId:n,onCreate:o,readOnly:S=!1,scrollingParentSelector:w,hideForPreview:A=!1,animationsExtensionEnabled:x=!1}=e,[k]=(0,h.useState)(()=>performance.now()),{timeOnCreate:C,timeOnSetupProvider:T,timeOnDownloadDoc:P}=(0,F.n6)(),D=(0,H.rd)(),{isUserLoading:z}=(0,Y.ur)(),[_,N]=(0,h.useState)(!1),R=(0,h.useRef)(!1);R.current=_;let[W,K]=(0,h.useState)(!1),[Z,Q]=(0,h.useState)(!1),$=(0,h.useRef)([]),[ee,et]=(0,h.useState)(),[eo,er]=(0,h.useState)(),[es,ea]=(0,h.useState)(),[ei]=(0,h.useState)(()=>new nE),el=(0,tX.t)(),{onTransaction:ed,getTransaction:ec}=nM(),eu=(0,B.iJ)(),ep=(0,B.iO)(),{isConnected:eh}=(0,v.u)(),em=nq(n,W),eg=oy(eo);ns(ee,es);let ef=op({editor:ee,yProvider:es,enabled:W&&!S});(0,t$.Rf)(ee);let[ey,ev,eS,ew]=oh(),eA=t&&t.organization&&t.organization.id,eM=nO({docId:n,enabled:!W}),eE=(0,L.u)("debugLogging"),ek=(0,E.GV)(M.Gm),eC=(0,L.u)("waitForGammaPersistenceMeta"),eT=(0,E.jL)(),{logMessages:eD,logPerfMessage:eI,dumpLog:eN}=nC(eE);(0,U.C)((0,h.useCallback)(()=>{es&&(es.disconnect(),es.configuration.parameters=ob(n),setTimeout(()=>es.connect(),500))},[es,n])),(0,y.A)(),(0,nj.W)(ee),(0,h.useEffect)(()=>{let e;if(!es)return;let t=eS>10;if(ev){console.warn("[CollaborativeEditor] Attempted to re-connect while rate limited (".concat(eS," of ").concat(10,").")),es.disconnect();return}if(t){console.error("[CollaborativeEditor - RECONNECT_RATE_LIMIT] Max rate limit violations reached (".concat(10,"). Will reload.")),setTimeout(()=>{window.location.reload()},500);return}if(R.current)return ew?(console.debug("[CollaborativeEditor] Backgrounded, will wait ".concat(12e4,"s before disconnect")),e=m.wg(()=>{console.debug("[CollaborativeEditor] Disconnecting after grace period"),es.disconnect()},12e4)):(console.debug("[CollaborativeEditor] Foregrounded, so re-connecting"),es.connect()),()=>{e&&m.DJ(e)}},[es,ew,ev,eS]),(0,h.useEffect)(()=>{ee&&!ee.isDestroyed&&eA&&(ee.commands.initializeUploadExtension(eA),ee.commands.removeGeneratorInputsOnLoad())},[ee,eA]),(0,h.useEffect)(()=>{eo&&n&&em&&eu.loadYDoc(n,eo,()=>{console.debug("offlineMode - [ydocOfflineApi] YDoc loaded from indexeddb"),K(!0),N(!0)})},[em,eo,n,eu]),(0,h.useEffect)(()=>{console.debug("[CollaborativeEditor] Creating yProvider for doc",n);let e=new g.JA({});e.getXmlFragment("default").observeDeep((e,t)=>{ed(t)}),er(e),e.getMap("GammaPersistenceMeta").observeDeep((t,n)=>{e.getMap("GammaPersistenceMeta").get("READY")&&(eI("Document data downloaded"),Q(!0))}),eI("Setting up hocuspocus"),T();let t=new u.m({name:n,document:e,forceSyncInterval:15e3,token:ob(n).SHARE_TOKEN||"null",websocketProvider:new u.nU({url:f.$.MULTIPLAYER_WS_URL,parameters:ob(n)}),preserveConnection:!1,onOutgoingMessage(e){let{message:t}=e;try{let e=Math.floor(performance.now()-k),n=ng.fromOutgoingMessage(t,e);n.shouldAssociateTransaction()&&n.setTransaction(ec()),ei.onMessage(n)}catch(e){console.error("[CollaborativeEditor] Error processing outgoing message for debug",e)}},onMessage(e){let{message:t}=e;try{let e=Math.floor(performance.now()-k),n=ng.fromIncomingMessage(t.data,e);n.shouldAssociateTransaction()&&n.setTransaction(ec()),ei.onMessage(n)}catch(e){console.error("[CollaborativeEditor] Error processing incoming message for debug",e)}},onOpen(){if(!0===M.of.get("hocuspocusOnAuthenticate"))return void console.log("[CollaborativeEditor] Provider opened. onAuthenticate is enabled so this is a no-op.");t.isAuthenticated=!0,console.log("[CollaborativeEditor] Provider opened.  Setting isAuthenticated to true.")},onStatus(e){let{status:t}=e;console.debug("[CollaborativeEditor][onStatus]",{status:t}),"connected"===t?(eI("Hocuspocus connected"),N(!0),R.current=!0):"connecting"===t&&(eI("Hocuspocus connecting"),ey())},onSynced(){console.debug("[CollaborativeEditor] Provider synced"),K(!0),eM(),eI("Document data downloaded"),eu.syncYDoc(n,e)},onDisconnect(e){let{event:n}=e;n.code===c.hR.code?console.error('[CollaborativeEditor] Provider disconnected with "Unauthorized.code", which is unexpected.',n):1008===n.code&&(t.disconnect(),J.LF.emit(J.DN.Y_DOC_IS_TOO_LARGE,{}),console.error("[CollaborativeEditor][onDisconnect] Document is too large, disconnecting"))}});return t.subscribeToBroadcastChannel(),ea(t),eT((0,t0.gS)({hocuspocusProvider:t})),f.$.DEBUG_ENABLED&&(window.gammaEditorProvider=t),$.current=[...x?[e_.Q]:[],tV.EX,tK,t$.Li.configure({scrollerSelector:w}),tc.configure({document:e}),tp,X.configure({provider:t}),tT.configure({provider:t}),e1.configure({document:e}),e8,e9,e5.configure(),ex,tG.bY,tq,tQ.V,en.configure({document:e}),ez,eP,tW.c,tI.mk,tJ.Q8,tB.wg,tZ.bU,p.o5.configure({openDoubleQuote:!1,closeDoubleQuote:!1,openSingleQuote:!1,closeSingleQuote:!1}),tD.configure({scrollerSelector:w}),eb,ta,to,tH,G.o.configure({document:e}),tL.configure({startTime:k,messageLogger:ei,provider:t})],()=>{console.warn("[CollaborativeEditor] Destroying yProvider for doc ",n),t.disconnect(),t.destroy(),delete window.gammaEditorProvider,ea(void 0),K(!1),N(!1),Q(!1),setTimeout(()=>{if(t&&t.awareness)try{t.awareness.destroy()}catch(e){console.warn("[CollaborativeEditor] Error destroying awareness provider.")}})}},[]);let eR=!!(_&&W&&(!eC||Z)&&t&&!z);(0,h.useEffect)(()=>{eR&&(eI("Is ready for TipTap"),P())},[eR,P,eI]),(0,b.p5)(),I(ee),O(ee,n);let eO=(0,j.K)(),ej=(0,L.u)("exportScaleContentToFit");return(0,r.jsxs)(s.a,{display:A?"none":"block",w:"100%","data-testid":"collaborative-editor-wrapper",children:[eR&&ek&&(0,r.jsx)(t7,{editor:ee}),!ee&&(0,r.jsx)(s.a,{flexDirection:"column",flex:"1",w:"100%",h:"var(--100vh)",bg:D?"gray.800":"gray.50",zIndex:"overlay","data-testid":"collaborative-editor-skeleton",inset:0,children:(0,r.jsx)(a.o,{h:"100%",children:(0,r.jsxs)(i.B,{align:"center",children:[(0,r.jsx)(l.y,{}),eD.map((e,t)=>{let{msg:n}=e;return(0,r.jsx)(d.E,{children:n},t)})]})})}),eR&&(0,r.jsx)(V.b,{extensions:$.current,doc:t,docId:n,editorId:"main",onCreate:e=>{let{editor:t}=e;setTimeout(()=>{et(t),o&&o(t),requestAnimationFrame(()=>{if(eh&&ep(n),eO(t),ej){let e=(0,E.KA)();(0,q.el)({editor:t,store:e,viewportScaleFactor:el})}eI("Editor rendered"),C(),eN()})},10)},readOnly:eg||S||!em&&ef,shouldSupportComments:!0,shouldSupportMenus:!0,scrollingParentSelector:w})]})});oS.displayName="CollaborativeEditor";var ow=n(87386),oA=n(35198);let oM=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{docFlags:{}};return(0,ow.createDocWithCards)(t,[{type:"card",content:[{type:"cardLayoutItem",attrs:{itemId:"body"},content:[{type:"title",attrs:{level:oA.f.DefaultTitle}},{type:"contributors"}]}]},{type:"card",content:[{type:"cardLayoutItem",attrs:{itemId:"body"},content:[{type:"heading"}]}]}])},oE=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,ow.createDocWithCards)(e,[{type:"card",content:[{type:"cardLayoutItem",attrs:{itemId:"body"},content:[{type:"title",attrs:{level:oA.f.DefaultTitle}}]}]}])},ox=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{docFlags:{}};return{type:"doc",content:[{type:"document",attrs:t,content:[{type:"card",content:[{type:"title",attrs:{level:oA.f.DefaultTitle}},{type:"contributors"}]},{type:"card",attrs:{previewContent:null,background:{type:"none"},container:{},cardSize:"default",layout:"blank"},content:[{type:"heading",attrs:{horizontalAlign:null,level:2},content:[{type:"text",text:"Quick Start Checklist"}]},{type:"todo",attrs:{indent:0,checked:!1,fontSize:null},content:[{type:"emoji",attrs:{id:"zap",native:""}},{type:"text",text:" "},{type:"text",marks:[{type:"bold"}],text:"Type "},{type:"text",marks:[{type:"code"}],text:"/"},{type:"text",marks:[{type:"bold"}],text:" in a card to open the slash menu"}]},{type:"bullet",attrs:{indent:1,fontSize:null},content:[{type:"text",text:"It lets you browse and add content blocks quickly"}]},{type:"bullet",attrs:{indent:1,fontSize:null},content:[{type:"text",text:"Content blocks can be added from the "},{type:"text",marks:[{type:"footnoteLabel",attrs:{noteId:"7jZEg"}}],text:"insert menu"},{type:"footnote",attrs:{noteId:"7jZEg"},content:[{type:"image",attrs:{id:"Y3FmX",horizontalAlign:null,src:"https://cdn.gamma.app/zc87vhr30n8uf3n/b98e59519a994c7abd900f44683bbb5d/optimized/insert-menu-explainer.gif",tempUrl:"blob:https://gamma.app/983566b4-f21e-4d28-bc69-d448c1976833",uploadStatus:0,meta:{width:700,height:459,date_file_modified:"2023/01/20 23:08:42 GMT",duration:4.42,aspect_ratio:1.525,has_clipping_path:!1,frame_count:36,colorspace:"RGB",average_color:"#f7f5f5"},providerMeta:null,name:"insert-menu-explainer.gif",query:null,source:"image.custom",showPlaceholder:!1,fullWidthBlock:!1,resize:{clipType:null,clipPath:null,clipAspectRatio:null,width:null}}}]},{type:"text",text:" if you prefer to drag"}]},{type:"todo",attrs:{indent:0,checked:!1,fontSize:null},content:[{type:"emoji",attrs:{id:"heavy_plus_sign",native:""}},{type:"text",text:" "},{type:"text",marks:[{type:"bold"}],text:"Add a new card"},{type:"text",text:" (type "},{type:"text",marks:[{type:"code"}],text:"/card"},{type:"text",text:") or select a template via the "},{type:"text",marks:[{type:"footnoteLabel",attrs:{noteId:"xLt8J"}}],text:"plus button"},{type:"footnote",attrs:{noteId:"xLt8J"},content:[{type:"image",attrs:{id:"3CSXR",horizontalAlign:null,src:"https://cdn.gamma.app/zc87vhr30n8uf3n/a8d6b7149f75401ebd54e6b022670a3e/optimized/image.png",tempUrl:"blob:https://gamma.app/5368f25a-cf30-4410-bf62-bd26080b01f5",uploadStatus:0,meta:{width:844,height:608,date_file_modified:"2023/01/20 21:38:09 GMT",aspect_ratio:1.388,has_clipping_path:!1,frame_count:1,colorspace:"RGB",average_color:"#f7f5f5"},providerMeta:null,name:"image.png",query:null,source:"image.custom",showPlaceholder:!1,fullWidthBlock:!1,resize:{clipType:null,clipPath:null,clipAspectRatio:null,width:null}}}]}]},{type:"todo",attrs:{indent:0,checked:!1,fontSize:null},content:[{type:"emoji",attrs:{id:"newspaper",native:"\uD83D\uDCF0"}},{type:"text",text:" "},{type:"text",marks:[{type:"bold"}],text:"Create multi-column layouts"},{type:"text",text:" (type "},{type:"text",marks:[{type:"code"}],text:"/columns"},{type:"text",text:") or "},{type:"text",marks:[{type:"footnoteLabel",attrs:{noteId:"JyryA"}}],text:"drag blocks"},{type:"footnote",attrs:{noteId:"JyryA"},content:[{type:"image",attrs:{id:"iJXTh",horizontalAlign:null,src:"https://cdn.gamma.app/zc87vhr30n8uf3n/3e47c137ba5d4d13bdafda584b3a8f94/optimized/drag-columns-optimized.gif",tempUrl:"blob:https://gamma.app/654cd2e0-6972-4a24-a7c0-25eff0cf9050",uploadStatus:0,meta:{width:500,height:313,date_file_modified:"2023/01/20 21:35:04 GMT",duration:9.83,aspect_ratio:1.597,has_clipping_path:!1,frame_count:62,colorspace:"RGB",average_color:"#e8cac5"},providerMeta:null,name:"drag-columns-optimized.gif",query:null,source:"image.custom",showPlaceholder:!1,fullWidthBlock:!1,resize:{clipType:null,clipPath:null,clipAspectRatio:null,width:null}}}]},{type:"text",text:" side by side"}]},{type:"todo",attrs:{indent:0,checked:!1,fontSize:null},content:[{type:"emoji",attrs:{id:"bridge_at_night",native:"\uD83C\uDF09"}},{type:"text",text:" "},{type:"text",marks:[{type:"bold"}],text:"Add an image "},{type:"text",text:"(type "},{type:"text",marks:[{type:"code"}],text:"/image"},{type:"text",text:"). You can drag in or paste image files too!"}]},{type:"todo",attrs:{indent:0,checked:!1,fontSize:null},content:[{type:"emoji",attrs:{id:"art",native:"\uD83C\uDFA8"}},{type:"text",text:" "},{type:"text",marks:[{type:"bold"}],text:"Change the deck "},{type:"text",marks:[{type:"bold"},{type:"footnoteLabel",attrs:{noteId:"mTOBc"}}],text:"theme"},{type:"footnote",attrs:{noteId:"mTOBc"},content:[{type:"paragraph",attrs:{horizontalAlign:null,fontSize:null},content:[{type:"text",text:"Click the "},{type:"text",marks:[{type:"code"}],text:"Theme"},{type:"text",text:" button in the top toolbar, then try clicking some of the different options"}]},{type:"image",attrs:{id:"GHNdu",horizontalAlign:"center",src:"https://cdn.gamma.app/zc87vhr30n8uf3n/db839cee72b7497b9ff1424987641ed5/optimized/image.png",tempUrl:null,uploadStatus:0,meta:{width:806,height:1678,date_file_modified:"2022/08/01 23:13:09 GMT",aspect_ratio:.48,has_clipping_path:!1,frame_count:1,colorspace:"RGB",average_color:"#ccc7ca"},providerMeta:null,name:"image.png",query:null,source:"image.custom",showPlaceholder:!1,fullWidthBlock:!1,resize:{clipType:"inset",clipPath:["17.31441903150651%","0%","41.5572854690296%","0%"],clipAspectRatio:1.1678975712005124,width:209.77777777777777}}}]},{type:"text",text:" to give it a different look and feel"}]},{type:"todo",attrs:{indent:0,checked:!1,fontSize:null},content:[{type:"emoji",attrs:{id:"arrow_forward",native:""}},{type:"text",text:" "},{type:"text",marks:[{type:"bold"}],text:"Try present mode"},{type:"text",text:" and use your arrow keys and "},{type:"text",marks:[{type:"footnoteLabel",attrs:{noteId:"UGnAU"}}],text:"spotlight"},{type:"footnote",attrs:{noteId:"UGnAU"},content:[{type:"paragraph",attrs:{horizontalAlign:null,fontSize:null},content:[{type:"text",text:"Spotlight lets you"},{type:"text",marks:[{type:"bold"}],text:" focus "},{type:"text",text:"on"},{type:"text",marks:[{type:"bold"}],text:" one piece of content at a time. "},{type:"text",text:"While presenting, press "},{type:"text",marks:[{type:"code"}],text:"s"},{type:"text",text:" to enter spotlight mode."}]},{type:"image",attrs:{id:"YOFhU",horizontalAlign:null,src:"https://cdn.gamma.app/zc87vhr30n8uf3n/ed0b362f6c2f4a438cd3188ba7697a02/optimized/spotlight-compressed.gif",tempUrl:"blob:https://gamma.app/d2eaae7f-515e-4e06-b396-4b0551a5a999",uploadStatus:0,meta:{width:1200,height:750,date_file_modified:"2023/01/13 21:48:00 GMT",duration:6.66,aspect_ratio:1.6,has_clipping_path:!1,frame_count:34,colorspace:"RGB",average_color:"#323030"},providerMeta:null,name:"spotlight-compressed.gif",query:null,source:"image.custom",showPlaceholder:!1,fullWidthBlock:!1,resize:{clipType:null,clipPath:null,clipAspectRatio:null,width:null}}}]},{type:"text",text:" to move around"}]},{type:"todo",attrs:{indent:0,checked:!1,fontSize:null},content:[{type:"emoji",attrs:{id:"tada",native:"\uD83C\uDF89"}},{type:"text",text:" "},{type:"text",marks:[{type:"bold"}],text:"Share your deck"},{type:"text",text:"."},{type:"text",marks:[{type:"bold"}],text:" "},{type:"text",text:"Publish it to the world, invite others, or export a PDF"}]}]}]}]}};var ok=n(74127)},69764:(e,t,n)=>{n.d(t,{R:()=>c,k:()=>d});var o=n(83817),r=n.n(o),s=n(55729),a=n(15342),i=n(43634),l=n(60300);let d=e=>{let t=(0,a.GV)(i.FI,function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return r()(...t)});return(0,s.useMemo)(()=>({enabled:!!(e&&t&&(0,l.UE)(e,t)),pos:null==t?void 0:t.pos}),[e,t])},c=e=>{let t=(0,a.GV)(i.e4),n=(0,a.GV)(i._I,function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return r()(...t)});(0,s.useEffect)(()=>{if(!e||!t||!n)return;console.debug("[useScrollAndSpotlightSync] collaboratorBeingFollowed spotlight or scroll changed",JSON.stringify(n,null,2));let{spotlight:o,scroll:r}=n;e.commands.syncSpotlightAndScroll({spotlight:o,scroll:r,scrollOffset:100,isFollowing:!0})},[e,t,n])}},74127:(e,t,n)=>{n.d(t,{u:()=>i});var o=n(6029),r=n(74158),s=n(20011),a=n(10817);let i=e=>{let{...t}=e,{reduxData:n,...i}=t,l=(0,s.F)(n);return(0,o.jsx)(r.Kq,{store:l,children:(0,o.jsx)(a.b,{...i,readOnly:!0,isStatic:!0,animationsEnabled:!1})})}},78116:(e,t,n)=>{n.d(t,{Q:()=>a});var o=n(37243),r=n(61121),s=n(85570);let a=o.YY.create({name:"animations",addOptions:()=>({}),addCommands:()=>({addAnimationPositions:(e,t)=>n=>{let{state:o,dispatch:r}=n;return r&&o.tr.setMeta(s.g,{type:"addAnimationPositions",isPresentMode:t,pos:e}),!0},enableAnimations:e=>t=>{let{state:n,dispatch:o}=t;return o&&n.tr.setMeta(s.g,{type:"enableAnimations",enabled:e}),!0},resetAnimationPositions:e=>t=>{let{state:n,dispatch:o}=t;return o&&n.tr.setMeta(s.g,{type:"resetAnimationPositions",isPresentMode:e}),!0}}),addProseMirrorPlugins:()=>[(0,r.ZY)()]})},85570:(e,t,n)=>{n.d(t,{g:()=>o});let o=new(n(63867)).hs("animation")},86497:(e,t,n)=>{n.d(t,{O:()=>s});var o=n(32617),r=n(5291);let s=()=>{let e=(0,o.u)("offlineEditing"),t=(0,r.b9)();return e&&t}},93321:(e,t,n)=>{n.d(t,{C8:()=>f,R:()=>y,Ty:()=>v});var o=n(4765),r=n(12364),s=n.n(r),a=n(55729),i=n(22249),l=n(15342),d=n(3738),c=n(43634),u=n(15607),p=n(36679);let h={portrait:{max:1,min:.4},landscape:{max:1,min:.5}};function m(e,t){var n;let o=e&&getComputedStyle(e).getPropertyValue(t);return o?parseInt(null==(n=o.match(/\d+/))?void 0:n[0],10):0}let g=e=>{let{cardWrapperWidth:t,cardWrapperLeftPaddingNum:n,cardWrapperRightPaddingNum:o}=e;return t-n-o},f=e=>{let{max:t,min:n}=h[e||"landscape"]||h.landscape;return{max:t,min:n}},y=()=>f((0,l.GV)(c.fX)),v=e=>{let{editor:t,editorWrapperDiv:n,aspectRatioValue:r}=e,h=(0,l.jL)(),{max:f,min:v}=y(),b=(0,a.useCallback)(e=>{e<f&&e>v?h((0,c.Ye)({zoomLevel:e})):e>=f?h((0,c.Ye)({zoomLevel:f})):e<=v&&h((0,c.Ye)({zoomLevel:v}))},[h,f,v]),S=(0,l.GV)((0,i.lp)("left")),w=(0,l.GV)((0,i.lp)("right")),A=(0,l.GV)(c.yh),M=t&&(0,u.jB)(t,0),E=(0,d.E)(),x=(0,a.useCallback)(()=>{try{if(!n)return;document.body.classList.add(p.Ur);let e=function(e,t){let n=null==e?void 0:e.querySelector(".card-wrapper"),o=m(n,"padding-top"),r=m(n,"padding-bottom"),s=null==n?void 0:n.clientWidth,a=m(n,"padding-left"),i=m(n,"padding-right");return{editorHeight:t.clientHeight,cardWrapperTopPaddingNum:o,cardWrapperBottomPaddingNum:r,cardWrapperWidth:s,cardWrapperLeftPaddingNum:a,cardWrapperRightPaddingNum:i}}(M,n);if(0===e.cardWrapperWidth)return;let t=g(e),o=r&&t/r,s=function(e){let{editorHeight:t,cardWrapperTopPaddingNum:n,cardWrapperBottomPaddingNum:o}=e;return t-n-o}(e),a=o&&o-s;if(r&&a&&a>-10){let e=s*r,t=Math.round(e/E*100);b(t/100)}else{let e=Math.round(t/E*100);b(e/100)}requestAnimationFrame(()=>{document.body.classList.remove(p.Ur)})}catch(e){o.Cp(e),console.error(e)}},[n,r,M,E,b]);(0,a.useEffect)(()=>{A&&x()},[A,x]),(0,a.useEffect)(()=>{A&&s()(x,200)()},[A,x,S,w]),(0,a.useEffect)(()=>(A&&window.addEventListener("resize",x),A||window.removeEventListener("resize",x),()=>{window.removeEventListener("resize",x)}),[x,A])}}}]);
//# sourceMappingURL=8104-aa89b12d6c1c982b.js.map